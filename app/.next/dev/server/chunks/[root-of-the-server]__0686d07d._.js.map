{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///Users/dmakowski/git_priv/kubevista/app/lib/github/client.ts"],"sourcesContent":["import { Octokit } from '@octokit/rest'\n\nexport interface YamlFile {\n  name: string\n  path: string\n  sha: string\n  type: 'file' | 'dir'\n}\n\nexport interface KustomizeStructure {\n  hasKustomization: boolean\n  basePath: string | null\n  overlays: string[]\n  baseFiles: YamlFile[]\n  overlayFiles: Record<string, YamlFile[]>\n}\n\nexport class GitHubClient {\n  private octokit: Octokit\n\n  constructor(accessToken: string) {\n    this.octokit = new Octokit({ auth: accessToken })\n  }\n\n  /**\n   * List user's repositories\n   */\n  async listRepositories(): Promise<Array<{ owner: string; repo: string; fullName: string; defaultBranch: string }>> {\n    const { data } = await this.octokit.repos.listForAuthenticatedUser({\n      sort: 'updated',\n      per_page: 100,\n    })\n\n    return data.map((repo) => ({\n      owner: repo.owner.login,\n      repo: repo.name,\n      fullName: repo.full_name,\n      defaultBranch: repo.default_branch || 'main',\n    }))\n  }\n\n  /**\n   * List YAML files in repository (recursive)\n   */\n  async listYamlFiles(\n    owner: string,\n    repo: string,\n    path: string = '',\n    ref: string = 'main'\n  ): Promise<YamlFile[]> {\n    const files: YamlFile[] = []\n\n    try {\n      const { data } = await this.octokit.repos.getContent({\n        owner,\n        repo,\n        path,\n        ref,\n      })\n\n      if (Array.isArray(data)) {\n        for (const item of data) {\n          if (item.type === 'file' && (item.name.endsWith('.yaml') || item.name.endsWith('.yml'))) {\n            files.push({\n              name: item.name,\n              path: item.path,\n              sha: item.sha!,\n              type: 'file',\n            })\n          } else if (item.type === 'dir') {\n            // Recursively search subdirectories\n            const subFiles = await this.listYamlFiles(owner, repo, item.path, ref)\n            files.push(...subFiles)\n          }\n        }\n      }\n    } catch (error) {\n      console.error(`Error listing files in ${path}:`, error)\n    }\n\n    return files\n  }\n\n  /**\n   * Get file content\n   */\n  async getFileContent(\n    owner: string,\n    repo: string,\n    path: string,\n    ref: string = 'main'\n  ): Promise<{ content: string; sha: string }> {\n    const { data } = await this.octokit.repos.getContent({\n      owner,\n      repo,\n      path,\n      ref,\n    })\n\n    if ('content' in data && data.type === 'file') {\n      const content = Buffer.from(data.content, 'base64').toString('utf-8')\n      return { content, sha: data.sha }\n    }\n\n    throw new Error('Path is not a file')\n  }\n\n  /**\n   * Detect if directory contains kustomization.yaml\n   */\n  async detectKustomization(owner: string, repo: string, dirPath: string, ref: string = 'main'): Promise<boolean> {\n    try {\n      const { data } = await this.octokit.repos.getContent({\n        owner,\n        repo,\n        path: dirPath,\n        ref,\n      })\n\n      if (Array.isArray(data)) {\n        return data.some(\n          (item) =>\n            item.type === 'file' &&\n            (item.name === 'kustomization.yaml' || item.name === 'kustomization.yml')\n        )\n      }\n\n      return false\n    } catch {\n      return false\n    }\n  }\n\n  /**\n   * Get Kustomize structure (base + overlays)\n   */\n  async getKustomizeStructure(\n    owner: string,\n    repo: string,\n    filePath: string,\n    ref: string = 'main'\n  ): Promise<KustomizeStructure> {\n    const dirPath = filePath.substring(0, filePath.lastIndexOf('/'))\n    const hasKustomization = await this.detectKustomization(owner, repo, dirPath, ref)\n\n    if (!hasKustomization) {\n      return {\n        hasKustomization: false,\n        basePath: null,\n        overlays: [],\n        baseFiles: [],\n        overlayFiles: {},\n      }\n    }\n\n    // Check if this is a base or overlay directory\n    const isBase = dirPath.endsWith('/base') || !dirPath.includes('overlay')\n    let basePath: string\n    let overlayParentPath: string\n\n    if (isBase) {\n      basePath = dirPath\n      overlayParentPath = dirPath.replace('/base', '/overlays')\n    } else {\n      // We're in an overlay\n      const overlayMatch = dirPath.match(/(.*)\\/overlays\\/([^/]+)/)\n      if (overlayMatch) {\n        basePath = `${overlayMatch[1]}/base`\n        overlayParentPath = `${overlayMatch[1]}/overlays`\n      } else {\n        basePath = dirPath\n        overlayParentPath = `${dirPath}/overlays`\n      }\n    }\n\n    // Get base files\n    const baseFiles = await this.listYamlFiles(owner, repo, basePath, ref)\n\n    // Get overlay directories\n    const overlays: string[] = []\n    const overlayFiles: Record<string, YamlFile[]> = {}\n\n    try {\n      const { data: overlayData } = await this.octokit.repos.getContent({\n        owner,\n        repo,\n        path: overlayParentPath,\n        ref,\n      })\n\n      if (Array.isArray(overlayData)) {\n        const overlayDirs = overlayData.filter((item) => item.type === 'dir').map((item) => item.name)\n        overlays.push(...overlayDirs)\n\n        // Get files for each overlay\n        for (const overlay of overlayDirs) {\n          const overlayPath = `${overlayParentPath}/${overlay}`\n          overlayFiles[overlay] = await this.listYamlFiles(owner, repo, overlayPath, ref)\n        }\n      }\n    } catch {\n      // No overlays directory - this is fine\n    }\n\n    return {\n      hasKustomization: true,\n      basePath,\n      overlays,\n      baseFiles,\n      overlayFiles,\n    }\n  }\n\n  /**\n   * Merge a pull request\n   */\n  async mergePullRequest(\n    owner: string,\n    repo: string,\n    pullNumber: number,\n    mergeMethod: 'merge' | 'squash' | 'rebase' = 'merge'\n  ): Promise<{ merged: boolean; message: string }> {\n    try {\n      const { data } = await this.octokit.pulls.merge({\n        owner,\n        repo,\n        pull_number: pullNumber,\n        merge_method: mergeMethod,\n      })\n\n      return {\n        merged: true,\n        message: data.message,\n      }\n    } catch (error: any) {\n      return {\n        merged: false,\n        message: error.message || 'Failed to merge PR',\n      }\n    }\n  }\n\n  /**\n   * List all branches in a repository\n   */\n  async listBranches(owner: string, repo: string): Promise<Array<{ name: string; protected: boolean }>> {\n    const { data } = await this.octokit.repos.listBranches({\n      owner,\n      repo,\n      per_page: 100,\n    })\n\n    return data.map((branch) => ({\n      name: branch.name,\n      protected: branch.protected,\n    }))\n  }\n\n  /**\n   * Get full repository tree (all files and directories)\n   */\n  async getRepositoryTree(\n    owner: string,\n    repo: string,\n    ref: string = 'main',\n    path: string = ''\n  ): Promise<Array<{ name: string; path: string; type: 'file' | 'dir'; size?: number }>> {\n    try {\n      const { data } = await this.octokit.repos.getContent({\n        owner,\n        repo,\n        path,\n        ref,\n      })\n\n      if (!Array.isArray(data)) {\n        // Single file\n        return [{\n          name: data.name,\n          path: data.path,\n          type: 'file',\n          size: data.size,\n        }]\n      }\n\n      // Directory - return all items\n      return data.map((item) => ({\n        name: item.name,\n        path: item.path,\n        type: item.type === 'dir' ? 'dir' : 'file',\n        size: item.type === 'file' ? item.size : undefined,\n      }))\n    } catch (error) {\n      console.error(`Error getting tree for ${path}:`, error)\n      return []\n    }\n  }\n\n  /**\n   * Create a new branch\n   */\n  async createBranch(\n    owner: string,\n    repo: string,\n    baseBranch: string,\n    newBranch: string\n  ): Promise<void> {\n    const { data: ref } = await this.octokit.git.getRef({\n      owner,\n      repo,\n      ref: `heads/${baseBranch}`,\n    })\n\n    await this.octokit.git.createRef({\n      owner,\n      repo,\n      ref: `refs/heads/${newBranch}`,\n      sha: ref.object.sha,\n    })\n  }\n\n  /**\n   * Commit file changes\n   */\n  async commitFile(\n    owner: string,\n    repo: string,\n    branch: string,\n    path: string,\n    content: string,\n    sha: string,\n    message: string\n  ): Promise<void> {\n    await this.octokit.repos.createOrUpdateFileContents({\n      owner,\n      repo,\n      path,\n      message,\n      content: Buffer.from(content).toString('base64'),\n      branch,\n      sha,\n    })\n  }\n\n  /**\n   * Create Pull Request\n   */\n  async createPullRequest(\n    owner: string,\n    repo: string,\n    title: string,\n    head: string,\n    base: string,\n    body: string\n  ): Promise<{ number: number; url: string }> {\n    const { data } = await this.octokit.pulls.create({\n      owner,\n      repo,\n      title,\n      head,\n      base,\n      body,\n    })\n\n    return {\n      number: data.number,\n      url: data.html_url,\n    }\n  }\n\n  /**\n   * Check if PR is merged\n   */\n  async isPullRequestMerged(owner: string, repo: string, prNumber: number): Promise<boolean> {\n    try {\n      await this.octokit.pulls.checkIfMerged({\n        owner,\n        repo,\n        pull_number: prNumber,\n      })\n      return true\n    } catch {\n      return false\n    }\n  }\n\n  /**\n   * List open PRs for a specific file\n   */\n  async getOpenPRsForFile(\n    owner: string,\n    repo: string,\n    filePath: string\n  ): Promise<Array<{ number: number; title: string; url: string }>> {\n    const { data: pulls } = await this.octokit.pulls.list({\n      owner,\n      repo,\n      state: 'open',\n      per_page: 100,\n    })\n\n    const prsForFile = []\n\n    for (const pull of pulls) {\n      const { data: files } = await this.octokit.pulls.listFiles({\n        owner,\n        repo,\n        pull_number: pull.number,\n      })\n\n      if (files.some((file) => file.filename === filePath)) {\n        prsForFile.push({\n          number: pull.number,\n          title: pull.title,\n          url: pull.html_url,\n        })\n      }\n    }\n\n    return prsForFile\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 355, "column": 0}, "map": {"version":3,"sources":["file:///Users/dmakowski/git_priv/kubevista/app/lib/github/get-token.ts"],"sourcesContent":["import { cookies } from 'next/headers'\n\n/**\n * Get GitHub App token from cookies\n * Returns the GitHub App installation token\n */\nexport async function getGitHubToken(): Promise<string | null> {\n  const cookieStore = await cookies()\n  const githubAppToken = cookieStore.get('github_app_token')?.value\n\n  return githubAppToken || null\n}\n"],"names":[],"mappings":";;;;AAAA;;AAMO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,iBAAiB,YAAY,GAAG,CAAC,qBAAqB;IAE5D,OAAO,kBAAkB;AAC3B"}},
    {"offset": {"line": 370, "column": 0}, "map": {"version":3,"sources":["file:///Users/dmakowski/git_priv/kubevista/app/lib/mocks/github-data.ts"],"sourcesContent":["// Mock data for GitHub repository browser\n\ninterface TreeItem {\n  name: string\n  path: string\n  type: 'file' | 'dir'\n  size?: number\n}\n\ninterface FileContent {\n  content: string\n  sha: string\n}\n\n// Mock repository tree structure\nconst mockTree: Record<string, TreeItem[]> = {\n  '/': [\n    { name: 'k8s', path: 'k8s', type: 'dir' },\n    { name: 'README.md', path: 'README.md', type: 'file', size: 1234 },\n    { name: '.gitignore', path: '.gitignore', type: 'file', size: 456 },\n  ],\n  'k8s': [\n    { name: 'base', path: 'k8s/base', type: 'dir' },\n    { name: 'overlays', path: 'k8s/overlays', type: 'dir' },\n    { name: 'deployments', path: 'k8s/deployments', type: 'dir' },\n    { name: 'services', path: 'k8s/services', type: 'dir' },\n    { name: 'configmaps', path: 'k8s/configmaps', type: 'dir' },\n    { name: 'namespace.yaml', path: 'k8s/namespace.yaml', type: 'file', size: 234 },\n  ],\n  'k8s/base': [\n    { name: 'kustomization.yaml', path: 'k8s/base/kustomization.yaml', type: 'file', size: 345 },\n    { name: 'frontend-deployment.yaml', path: 'k8s/base/frontend-deployment.yaml', type: 'file', size: 1200 },\n    { name: 'frontend-service.yaml', path: 'k8s/base/frontend-service.yaml', type: 'file', size: 400 },\n  ],\n  'k8s/overlays': [\n    { name: 'dev', path: 'k8s/overlays/dev', type: 'dir' },\n    { name: 'prod', path: 'k8s/overlays/prod', type: 'dir' },\n  ],\n  'k8s/overlays/dev': [\n    { name: 'kustomization.yaml', path: 'k8s/overlays/dev/kustomization.yaml', type: 'file', size: 250 },\n  ],\n  'k8s/overlays/prod': [\n    { name: 'kustomization.yaml', path: 'k8s/overlays/prod/kustomization.yaml', type: 'file', size: 280 },\n  ],\n  'k8s/deployments': [\n    { name: 'frontend.yaml', path: 'k8s/deployments/frontend.yaml', type: 'file', size: 1567 },\n    { name: 'backend.yaml', path: 'k8s/deployments/backend.yaml', type: 'file', size: 1823 },\n    { name: 'database.yaml', path: 'k8s/deployments/database.yaml', type: 'file', size: 2134 },\n  ],\n  'k8s/services': [\n    { name: 'frontend-svc.yaml', path: 'k8s/services/frontend-svc.yaml', type: 'file', size: 456 },\n    { name: 'backend-svc.yaml', path: 'k8s/services/backend-svc.yaml', type: 'file', size: 512 },\n    { name: 'database-svc.yaml', path: 'k8s/services/database-svc.yaml', type: 'file', size: 478 },\n  ],\n  'k8s/configmaps': [\n    { name: 'app-config.yaml', path: 'k8s/configmaps/app-config.yaml', type: 'file', size: 789 },\n    { name: 'nginx-config.yaml', path: 'k8s/configmaps/nginx-config.yaml', type: 'file', size: 1024 },\n  ],\n}\n\n// Mock file contents\nconst mockFiles: Record<string, string> = {\n  'README.md': `# Demo Application\n\nThis is a demo Kubernetes application for Orphelix.\n\n## Structure\n\n- \\`k8s/deployments\\` - Application deployments\n- \\`k8s/services\\` - Kubernetes services\n- \\`k8s/configmaps\\` - Configuration files\n\n## Usage\n\nApply the manifests:\n\n\\`\\`\\`bash\nkubectl apply -f k8s/\n\\`\\`\\`\n`,\n\n  '.gitignore': `node_modules/\n.next/\ndist/\nbuild/\n*.log\n.DS_Store\n.env.local\n`,\n\n  'k8s/namespace.yaml': `apiVersion: v1\nkind: Namespace\nmetadata:\n  name: demo-app\n  labels:\n    environment: production\n`,\n\n  'k8s/deployments/frontend.yaml': `apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: frontend\n  namespace: demo-app\n  labels:\n    app: frontend\n    tier: web\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: frontend\n  template:\n    metadata:\n      labels:\n        app: frontend\n        tier: web\n    spec:\n      containers:\n      - name: frontend\n        image: nginx:1.21\n        ports:\n        - containerPort: 80\n        resources:\n          requests:\n            memory: \"128Mi\"\n            cpu: \"250m\"\n          limits:\n            memory: \"256Mi\"\n            cpu: \"500m\"\n`,\n\n  'k8s/deployments/backend.yaml': `apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: backend\n  namespace: demo-app\n  labels:\n    app: backend\n    tier: api\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: backend\n  template:\n    metadata:\n      labels:\n        app: backend\n        tier: api\n    spec:\n      containers:\n      - name: backend\n        image: node:18-alpine\n        ports:\n        - containerPort: 3000\n        env:\n        - name: DATABASE_HOST\n          value: database-svc\n        - name: NODE_ENV\n          value: production\n        resources:\n          requests:\n            memory: \"256Mi\"\n            cpu: \"500m\"\n          limits:\n            memory: \"512Mi\"\n            cpu: \"1000m\"\n`,\n\n  'k8s/deployments/database.yaml': `apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: database\n  namespace: demo-app\n  labels:\n    app: database\n    tier: data\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: database\n  template:\n    metadata:\n      labels:\n        app: database\n        tier: data\n    spec:\n      containers:\n      - name: postgres\n        image: postgres:14\n        ports:\n        - containerPort: 5432\n        env:\n        - name: POSTGRES_DB\n          value: appdb\n        - name: POSTGRES_USER\n          value: admin\n        - name: POSTGRES_PASSWORD\n          valueFrom:\n            secretKeyRef:\n              name: db-secret\n              key: password\n        volumeMounts:\n        - name: postgres-storage\n          mountPath: /var/lib/postgresql/data\n        resources:\n          requests:\n            memory: \"512Mi\"\n            cpu: \"500m\"\n          limits:\n            memory: \"1Gi\"\n            cpu: \"1000m\"\n      volumes:\n      - name: postgres-storage\n        persistentVolumeClaim:\n          claimName: postgres-pvc\n`,\n\n  'k8s/services/frontend-svc.yaml': `apiVersion: v1\nkind: Service\nmetadata:\n  name: frontend-svc\n  namespace: demo-app\nspec:\n  type: LoadBalancer\n  selector:\n    app: frontend\n  ports:\n  - port: 80\n    targetPort: 80\n    protocol: TCP\n`,\n\n  'k8s/services/backend-svc.yaml': `apiVersion: v1\nkind: Service\nmetadata:\n  name: backend-svc\n  namespace: demo-app\nspec:\n  type: ClusterIP\n  selector:\n    app: backend\n  ports:\n  - port: 3000\n    targetPort: 3000\n    protocol: TCP\n`,\n\n  'k8s/services/database-svc.yaml': `apiVersion: v1\nkind: Service\nmetadata:\n  name: database-svc\n  namespace: demo-app\nspec:\n  type: ClusterIP\n  selector:\n    app: database\n  ports:\n  - port: 5432\n    targetPort: 5432\n    protocol: TCP\n`,\n\n  'k8s/configmaps/app-config.yaml': `apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: app-config\n  namespace: demo-app\ndata:\n  APP_NAME: \"Demo Application\"\n  LOG_LEVEL: \"info\"\n  API_TIMEOUT: \"30000\"\n  MAX_CONNECTIONS: \"100\"\n`,\n\n  'k8s/base/kustomization.yaml': `apiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\n\nresources:\n- frontend-deployment.yaml\n- frontend-service.yaml\n\ncommonLabels:\n  environment: base\n  managed-by: kustomize\n`,\n\n  'k8s/overlays/dev/kustomization.yaml': `apiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\n\nbases:\n- ../../base\n\nnamePrefix: dev-\n\ncommonLabels:\n  environment: dev\n`,\n\n  'k8s/overlays/prod/kustomization.yaml': `apiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\n\nbases:\n- ../../base\n\nnamePrefix: prod-\n\ncommonLabels:\n  environment: production\n\nreplicas:\n- name: frontend\n  count: 5\n`,\n\n  'k8s/configmaps/nginx-config.yaml': `apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: nginx-config\n  namespace: demo-app\ndata:\n  nginx.conf: |\n    user nginx;\n    worker_processes auto;\n    error_log /var/log/nginx/error.log;\n    pid /run/nginx.pid;\n\n    events {\n        worker_connections 1024;\n    }\n\n    http {\n        log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                          '$status $body_bytes_sent \"$http_referer\" '\n                          '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n        access_log  /var/log/nginx/access.log  main;\n\n        sendfile            on;\n        tcp_nopush          on;\n        keepalive_timeout   65;\n        types_hash_max_size 4096;\n\n        include             /etc/nginx/mime.types;\n        default_type        application/octet-stream;\n\n        server {\n            listen       80;\n            server_name  _;\n            root         /usr/share/nginx/html;\n\n            location / {\n                try_files $uri $uri/ /index.html;\n            }\n        }\n    }\n`,\n}\n\nexport function getMockRepositoryTree(path: string = ''): TreeItem[] {\n  const normalizedPath = path === '' ? '/' : path\n  return mockTree[normalizedPath] || []\n}\n\nexport function getMockFileContent(path: string): FileContent {\n  const content = mockFiles[path]\n  if (!content) {\n    throw new Error(`File not found: ${path}`)\n  }\n\n  // Generate a fake SHA based on the path\n  const sha = Buffer.from(path).toString('base64').slice(0, 40)\n\n  return {\n    content,\n    sha,\n  }\n}\n\nexport const mockGitHubRepo = {\n  owner: 'demo',\n  repo: 'kubernetes-manifests',\n  branch: 'main',\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 847, "column": 0}, "map": {"version":3,"sources":["file:///Users/dmakowski/git_priv/kubevista/app/app/api/github/file/route.ts"],"sourcesContent":["import { GitHubClient } from '@/lib/github/client'\nimport { NextRequest, NextResponse } from 'next/server'\nimport { getGitHubToken } from '@/lib/github/get-token'\nimport { getMockFileContent } from '@/lib/mocks/github-data'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const owner = searchParams.get('owner')\n    const repo = searchParams.get('repo')\n    const path = searchParams.get('path')\n    const ref = searchParams.get('ref') || 'main'\n    const mode = searchParams.get('mode')\n\n    if (!owner || !repo || !path) {\n      return NextResponse.json({ error: 'owner, repo and path are required' }, { status: 400 })\n    }\n\n    // Mock mode for demo\n    if (mode === 'demo') {\n      try {\n        const { content, sha } = getMockFileContent(path)\n        return NextResponse.json({ content, sha })\n      } catch {\n        return NextResponse.json({ error: 'File not found' }, { status: 404 })\n      }\n    }\n\n    const token = await getGitHubToken()\n\n    if (!token) {\n      return NextResponse.json({ error: 'Unauthorized - Please connect GitHub' }, { status: 401 })\n    }\n\n    const github = new GitHubClient(token)\n    const { content, sha } = await github.getFileContent(owner, repo, path, ref)\n\n    return NextResponse.json({ content, sha })\n  } catch (error) {\n    console.error('Failed to fetch file content:', error)\n    return NextResponse.json({ error: 'Failed to fetch file content' }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,QAAQ,aAAa,GAAG,CAAC;QAC/B,MAAM,OAAO,aAAa,GAAG,CAAC;QAC9B,MAAM,OAAO,aAAa,GAAG,CAAC;QAC9B,MAAM,MAAM,aAAa,GAAG,CAAC,UAAU;QACvC,MAAM,OAAO,aAAa,GAAG,CAAC;QAE9B,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,MAAM;YAC5B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoC,GAAG;gBAAE,QAAQ;YAAI;QACzF;QAEA,qBAAqB;QACrB,IAAI,SAAS,QAAQ;YACnB,IAAI;gBACF,MAAM,EAAE,OAAO,EAAE,GAAG,EAAE,GAAG,IAAA,6JAAkB,EAAC;gBAC5C,OAAO,gJAAY,CAAC,IAAI,CAAC;oBAAE;oBAAS;gBAAI;YAC1C,EAAE,OAAM;gBACN,OAAO,gJAAY,CAAC,IAAI,CAAC;oBAAE,OAAO;gBAAiB,GAAG;oBAAE,QAAQ;gBAAI;YACtE;QACF;QAEA,MAAM,QAAQ,MAAM,IAAA,wJAAc;QAElC,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuC,GAAG;gBAAE,QAAQ;YAAI;QAC5F;QAEA,MAAM,SAAS,IAAI,gJAAY,CAAC;QAChC,MAAM,EAAE,OAAO,EAAE,GAAG,EAAE,GAAG,MAAM,OAAO,cAAc,CAAC,OAAO,MAAM,MAAM;QAExE,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;YAAS;QAAI;IAC1C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA+B,GAAG;YAAE,QAAQ;QAAI;IACpF;AACF"}}]
}