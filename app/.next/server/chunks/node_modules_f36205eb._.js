module.exports=[563395,e=>{"use strict";let t,r,a,n,i;function o(e,t){if(null==e)return!1;try{return e instanceof t||Object.getPrototypeOf(e)[Symbol.toStringTag]===t.prototype[Symbol.toStringTag]}catch{return!1}}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(t="oauth4webapi/v3.8.3");let s="ERR_INVALID_ARG_VALUE",c="ERR_INVALID_ARG_TYPE";function u(e,t,r){let a=TypeError(e,{cause:r});return Object.assign(a,{code:t}),a}let p=Symbol(),d=Symbol(),l=Symbol(),h=Symbol(),y=Symbol(),f=Symbol(),m=Symbol(),w=new TextEncoder,g=new TextDecoder;function E(e){return"string"==typeof e?w.encode(e):g.decode(e)}function S(e){return"string"==typeof e?a(e):r(e)}r=Uint8Array.prototype.toBase64?e=>(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e.toBase64({alphabet:"base64url",omitPadding:!0})):e=>{e instanceof ArrayBuffer&&(e=new Uint8Array(e));let t=[];for(let r=0;r<e.byteLength;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return btoa(t.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},a=Uint8Array.fromBase64?e=>{try{return Uint8Array.fromBase64(e,{alphabet:"base64url"})}catch(e){throw u("The input to be decoded is not correctly encoded.",s,e)}}:e=>{try{let t=atob(e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}catch(e){throw u("The input to be decoded is not correctly encoded.",s,e)}};class A extends Error{code;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=e7,Error.captureStackTrace?.(this,this.constructor)}}class b extends Error{code;constructor(e,t){super(e,t),this.name=this.constructor.name,t?.code&&(this.code=t?.code),Error.captureStackTrace?.(this,this.constructor)}}function v(e,t,r){return new b(e,{code:t,cause:r})}async function _(e){let t;switch(e.kty){case"EC":t={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":t={crv:e.crv,kty:e.kty,x:e.x};break;case"AKP":t={alg:e.alg,kty:e.kty,pub:e.pub};break;case"RSA":t={e:e.e,kty:e.kty,n:e.n};break;default:throw new A("unsupported JWK key type",{cause:e})}return S(await crypto.subtle.digest("SHA-256",E(JSON.stringify(t))))}function k(e,t){if(!(e instanceof CryptoKey))throw u(`${t} must be a CryptoKey`,c)}function R(e,t){if(k(e,t),"private"!==e.type)throw u(`${t} must be a private CryptoKey`,s)}function P(e){return!(null===e||"object"!=typeof e||Array.isArray(e))}function C(e){o(e,Headers)&&(e=Object.fromEntries(e.entries()));let r=new Headers(e??{});if(t&&!r.has("user-agent")&&r.set("user-agent",t),r.has("authorization"))throw u('"options.headers" must not include the "authorization" header name',s);return r}function K(e,t){if(void 0!==t){if("function"==typeof t&&(t=t(e.href)),!(t instanceof AbortSignal))throw u('"options.signal" must return or be an instance of AbortSignal',c);return t}}function T(e){return e.includes("//")?e.replace("//","/"):e}async function W(e,t,r,a){if(!(e instanceof URL))throw u(`"${t}" must be an instance of URL`,c);eu(e,a?.[p]!==!0);let n=r(new URL(e.href)),i=C(a?.headers);return i.set("accept","application/json"),(a?.[h]||fetch)(n.href,{body:void 0,headers:Object.fromEntries(i.entries()),method:"GET",redirect:"manual",signal:K(n,a?.signal)})}async function J(e,t){return W(e,"issuerIdentifier",e=>{switch(t?.algorithm){case void 0:case"oidc":e.pathname=T(`${e.pathname}/.well-known/openid-configuration`);break;case"oauth2":!function(e,t,r=!1){"/"===e.pathname?e.pathname=t:e.pathname=T(`${t}/${r?e.pathname:e.pathname.replace(/(\/)$/,"")}`)}(e,".well-known/oauth-authorization-server");break;default:throw u('"options.algorithm" must be "oidc" (default), or "oauth2"',s)}return e},t)}function O(e,t,r,a,n){try{if("number"!=typeof e||!Number.isFinite(e))throw u(`${r} must be a number`,c,n);if(e>0)return;if(t){if(0!==e)throw u(`${r} must be a non-negative number`,s,n);return}throw u(`${r} must be a positive number`,s,n)}catch(e){if(a)throw v(e.message,a,n);throw e}}function I(e,t,r,a){try{if("string"!=typeof e)throw u(`${t} must be a string`,c,a);if(0===e.length)throw u(`${t} must not be empty`,s,a)}catch(e){if(r)throw v(e.message,r,a);throw e}}async function x(e,t){if(!(e instanceof URL)&&e!==t6)throw u('"expectedIssuerIdentifier" must be an instance of URL',c);if(!o(t,Response))throw u('"response" must be an instance of Response',c);if(200!==t.status)throw v('"response" is not a conform Authorization Server Metadata response (unexpected HTTP status code)',ti,t);tA(t);let r=await t1(t);if(I(r.issuer,'"response" body "issuer" property',ta,{body:r}),e!==t6&&new URL(r.issuer).href!==e.href)throw v('"response" body "issuer" property does not match the expected value',tp,{expected:e.href,body:r,attribute:"issuer"});return r}function D(e){var t=e,r="application/json";if(ex(t)!==r)throw U(t,r)}function U(e,...t){let r='"response" content-type must be ';if(t.length>2){let e=t.pop();r+=`${t.join(", ")}, or ${e}`}else 2===t.length?r+=`${t[0]} or ${t[1]}`:r+=t[0];return v(r,tn,e)}function H(){return S(crypto.getRandomValues(new Uint8Array(32)))}function L(){return H()}function j(){return H()}function N(){return H()}async function M(e){return I(e,"codeVerifier"),S(await crypto.subtle.digest("SHA-256",E(e)))}function $(e){return e instanceof CryptoKey?{key:e}:e?.key instanceof CryptoKey?(void 0!==e.kid&&I(e.kid,'"kid"'),{key:e.key,kid:e.kid}):{}}function B(e){switch(e.algorithm.name){case"RSA-PSS":switch(e.algorithm.hash.name){case"SHA-256":return"PS256";case"SHA-384":return"PS384";case"SHA-512":return"PS512";default:throw new A("unsupported RsaHashedKeyAlgorithm hash name",{cause:e})}case"RSASSA-PKCS1-v1_5":switch(e.algorithm.hash.name){case"SHA-256":return"RS256";case"SHA-384":return"RS384";case"SHA-512":return"RS512";default:throw new A("unsupported RsaHashedKeyAlgorithm hash name",{cause:e})}case"ECDSA":switch(e.algorithm.namedCurve){case"P-256":return"ES256";case"P-384":return"ES384";case"P-521":return"ES512";default:throw new A("unsupported EcKeyAlgorithm namedCurve",{cause:e})}case"Ed25519":case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return e.algorithm.name;case"EdDSA":return"Ed25519";default:throw new A("unsupported CryptoKey algorithm name",{cause:e})}}function z(e){let t=e?.[d];return"number"==typeof t&&Number.isFinite(t)?t:0}function G(e){let t=e?.[l];return"number"==typeof t&&Number.isFinite(t)&&-1!==Math.sign(t)?t:30}function F(){return Math.floor(Date.now()/1e3)}function q(e){if("object"!=typeof e||null===e)throw u('"as" must be an object',c);I(e.issuer,'"as.issuer"')}function V(e){if("object"!=typeof e||null===e)throw u('"client" must be an object',c);I(e.client_id,'"client.client_id"')}function X(e){return encodeURIComponent(e).replace(/(?:[-_.!~*'()]|%20)/g,e=>{switch(e){case"-":case"_":case".":case"!":case"~":case"*":case"'":case"(":case")":return`%${e.charCodeAt(0).toString(16).toUpperCase()}`;case"%20":return"+";default:throw Error()}})}function Y(e){return I(e,'"clientSecret"'),(t,r,a,n)=>{a.set("client_id",r.client_id),a.set("client_secret",e)}}function Q(e){return I(e,'"clientSecret"'),(t,r,a,n)=>{let i=X(r.client_id),o=X(e),s=btoa(`${i}:${o}`);n.set("authorization",`Basic ${s}`)}}function Z(e,t){let r=F()+z(t);return{jti:H(),aud:e.issuer,exp:r+60,iat:r,nbf:r,iss:t.client_id,sub:t.client_id}}function ee(e,t){let{key:r,kid:a}=$(e);return R(r,'"clientPrivateKey.key"'),async(e,n,i,o)=>{let s={alg:B(r),kid:a},c=Z(e,n);t?.[y]?.(s,c),i.set("client_id",n.client_id),i.set("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),i.set("client_assertion",await en(s,c,r))}}function et(e,t){let r;I(e,'"clientSecret"');let a=t?.[y];return async(t,n,i,o)=>{r||=await crypto.subtle.importKey("raw",E(e),{hash:"SHA-256",name:"HMAC"},!1,["sign"]);let s={alg:"HS256"},c=Z(t,n);a?.(s,c);let u=`${S(E(JSON.stringify(s)))}.${S(E(JSON.stringify(c)))}`,p=await crypto.subtle.sign(r.algorithm,r,E(u));i.set("client_id",n.client_id),i.set("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),i.set("client_assertion",`${u}.${S(new Uint8Array(p))}`)}}function er(){return(e,t,r,a)=>{r.set("client_id",t.client_id)}}function ea(){return er()}async function en(e,t,r){if(!r.usages.includes("sign"))throw u('CryptoKey instances used for signing assertions must include "sign" in their "usages"',s);let a=`${S(E(JSON.stringify(e)))}.${S(E(JSON.stringify(t)))}`,n=S(await crypto.subtle.sign(tP(r),r,E(a)));return`${a}.${n}`}async function ei(e,t,r,a,n){let i;q(e),V(t),r=new URLSearchParams(r);let{key:o,kid:c}=$(a);R(o,'"privateKey.key"'),r.set("client_id",t.client_id);let p=F()+z(t),d={...Object.fromEntries(r.entries()),jti:H(),aud:e.issuer,exp:p+60,iat:p,nbf:p,iss:t.client_id};r.has("resource")&&(i=r.getAll("resource"))&&i.length>1&&(d.resource=i);{let e=r.get("max_age");null!==e&&(d.max_age=parseInt(e,10),O(d.max_age,!0,'"max_age" parameter'))}{let e=r.get("claims");if(null!==e){try{d.claims=JSON.parse(e)}catch(e){throw v('failed to parse the "claims" parameter as JSON',tr,e)}if(!P(d.claims))throw u('"claims" parameter must be a JSON with a top level object',s)}}{let e=r.get("authorization_details");if(null!==e){try{d.authorization_details=JSON.parse(e)}catch(e){throw v('failed to parse the "authorization_details" parameter as JSON',tr,e)}if(!Array.isArray(d.authorization_details))throw u('"authorization_details" parameter must be a JSON with a top level array',s)}}let l={alg:B(o),typ:"oauth-authz-req+jwt",kid:c};return n?.[y]?.(l,d),en(l,d,o)}async function eo(e,t){let{kty:r,e:a,n:i,x:o,y:s,crv:c,pub:u}=await crypto.subtle.exportKey("jwk",e),p={kty:r,e:a,n:i,x:o,y:s,crv:c,pub:u};return"AKP"===r&&(p.alg=t),n.set(e,p),p}async function es(e,t){return(n||=new WeakMap).get(e)||eo(e,t)}let ec=URL.parse?(e,t)=>URL.parse(e,t):(e,t)=>{try{return new URL(e,t)}catch{return null}};function eu(e,t){if(t&&"https:"!==e.protocol)throw v("only requests to HTTPS are allowed",to,e);if("https:"!==e.protocol&&"http:"!==e.protocol)throw v("only HTTP and HTTPS requests are allowed",ts,e)}function ep(e,t,r,a){let n;if("string"!=typeof e||!(n=ec(e)))throw v(`authorization server metadata does not contain a valid ${r?`"as.mtls_endpoint_aliases.${t}"`:`"as.${t}"`}`,void 0===e?tl:th,{attribute:r?`mtls_endpoint_aliases.${t}`:t});return eu(n,a),n}function ed(e,t,r,a){return r&&e.mtls_endpoint_aliases&&t in e.mtls_endpoint_aliases?ep(e.mtls_endpoint_aliases[t],t,r,a):ep(e[t],t,r,a)}async function el(e,t,r,a,n){q(e),V(t);let i=ed(e,"pushed_authorization_request_endpoint",t.use_mtls_endpoint_aliases,n?.[p]!==!0),o=new URLSearchParams(a);o.set("client_id",t.client_id);let s=C(n?.headers);s.set("accept","application/json"),n?.DPoP!==void 0&&(eP(n.DPoP),await n.DPoP.addProof(i,s,"POST"));let c=await eU(e,t,r,i,o,s,n);return n?.DPoP?.cacheNonce(c,i),c}class eh{#e;#t;#r;#a;#n;#i;#o;constructor(e,t,r){if(R(t?.privateKey,'"DPoP.privateKey"'),!function(e,t){if(k(e,t),"public"!==e.type)throw u(`${t} must be a public CryptoKey`,s)}(t?.publicKey,'"DPoP.publicKey"'),!t.publicKey.extractable)throw u('"DPoP.publicKey.extractable" must be true',s);this.#n=r?.[y],this.#a=z(e),this.#t=t.privateKey,this.#r=t.publicKey,eY.add(this)}#s(e){this.#i||=new Map;let t=this.#i.get(e);return t&&(this.#i.delete(e),this.#i.set(e,t)),t}#c(e,t){this.#i||=new Map,this.#i.delete(e),100===this.#i.size&&this.#i.delete(this.#i.keys().next().value),this.#i.set(e,t)}async calculateThumbprint(){if(!this.#o){let e=await crypto.subtle.exportKey("jwk",this.#r);this.#o||=await _(e)}return this.#o}async addProof(e,t,r,a){let n=B(this.#t);this.#e||={alg:n,typ:"dpop+jwt",jwk:await es(this.#r,n)};let i=this.#s(e.origin),o={iat:F()+this.#a,jti:H(),htm:r,nonce:i,htu:`${e.origin}${e.pathname}`,ath:a?S(await crypto.subtle.digest("SHA-256",E(a))):void 0};this.#n?.(this.#e,o),t.set("dpop",await en(this.#e,o,this.#t))}cacheNonce(e,t){try{let r=e.headers.get("dpop-nonce");r&&this.#c(t.origin,r)}catch{}}}function ey(e){if(e instanceof eg){let{0:t,length:r}=e.cause;return 1===r&&"dpop"===t.scheme&&"use_dpop_nonce"===t.parameters.error}return e instanceof em&&"use_dpop_nonce"===e.error}function ef(e,t,r){return new eh(e,t,r)}class em extends Error{cause;code;error;status;error_description;response;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=e9,this.cause=t.cause,this.error=t.cause.error,this.status=t.response.status,this.error_description=t.cause.error_description,Object.defineProperty(this,"response",{enumerable:!1,value:t.response}),Error.captureStackTrace?.(this,this.constructor)}}class ew extends Error{cause;code;error;error_description;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=te,this.cause=t.cause,this.error=t.cause.get("error"),this.error_description=t.cause.get("error_description")??void 0,Error.captureStackTrace?.(this,this.constructor)}}class eg extends Error{cause;code;response;status;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=e3,this.cause=t.cause,this.status=t.response.status,this.response=t.response,Object.defineProperty(this,"response",{enumerable:!1}),Error.captureStackTrace?.(this,this.constructor)}}let eE="[a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+",eS=RegExp("^[,\\s]*("+eE+")"),eA=RegExp("^[,\\s]*("+eE+')\\s*=\\s*"((?:[^"\\\\]|\\\\[\\s\\S])*)"[,\\s]*(.*)'),eb=RegExp("^[,\\s]*"+("("+eE+")\\s*=\\s*(")+eE+")[,\\s]*(.*)"),ev=RegExp("^([a-zA-Z0-9\\-\\._\\~\\+\\/]+={0,2})(?:$|[,\\s])(.*)");async function e_(e,t,r){if(q(e),V(t),!o(r,Response))throw u('"response" must be an instance of Response',c);await eR(r,201,"Pushed Authorization Request Endpoint"),tA(r);let a=await t1(r);I(a.request_uri,'"response" body "request_uri" property',ta,{body:a});let n="number"!=typeof a.expires_in?parseFloat(a.expires_in):a.expires_in;return O(n,!0,'"response" body "expires_in" property',ta,{body:a}),a.expires_in=n,a}async function ek(e){if(e.status>399&&e.status<500){tA(e),D(e);try{let t=await e.clone().json();if(P(t)&&"string"==typeof t.error&&t.error.length)return t}catch{}}}async function eR(e,t,r){if(e.status!==t){let t;if(ez(e),t=await ek(e))throw await e.body?.cancel(),new em("server responded with an error in the response body",{cause:t,response:e});throw v(`"response" is not a conform ${r} response (unexpected HTTP status code)`,ti,e)}}function eP(e){if(!eY.has(e))throw u('"options.DPoP" is not a valid DPoPHandle',s)}async function eC(e,t,r,a,n,i){if(I(e,'"accessToken"'),!(r instanceof URL))throw u('"url" must be an instance of URL',c);eu(r,i?.[p]!==!0),a=C(a),i?.DPoP&&(eP(i.DPoP),await i.DPoP.addProof(r,a,t.toUpperCase(),e)),a.set("authorization",`${a.has("dpop")?"DPoP":"Bearer"} ${e}`);let o=await (i?.[h]||fetch)(r.href,{body:n,headers:Object.fromEntries(a.entries()),method:t,redirect:"manual",signal:K(r,i?.signal)});return i?.DPoP?.cacheNonce(o,r),o}async function eK(e,t,r,a,n,i){let o=await eC(e,t,r,a,n,i);return ez(o),o}async function eT(e,t,r,a){q(e),V(t);let n=ed(e,"userinfo_endpoint",t.use_mtls_endpoint_aliases,a?.[p]!==!0),i=C(a?.headers);return t.userinfo_signed_response_alg?i.set("accept","application/jwt"):(i.set("accept","application/json"),i.append("accept","application/jwt")),eC(r,"GET",n,i,null,{...a,[d]:z(t)})}function eW(e,t,r,a){(i||=new WeakMap).set(e,{jwks:t,uat:r,get age(){return F()-this.uat}}),a&&Object.assign(a,{jwks:structuredClone(t),uat:r})}function eJ(e,t){i?.delete(e),delete t?.jwks,delete t?.uat}async function eO(e,t,r){var a;let n,o,s,{alg:c,kid:u}=r;if(function(e){if(!function(e){switch(e){case"PS256":case"ES256":case"RS256":case"PS384":case"ES384":case"RS384":case"PS512":case"ES512":case"RS512":case"Ed25519":case"EdDSA":case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return!0;default:return!1}}(e.alg))throw new A('unsupported JWS "alg" identifier',{cause:{alg:e.alg}})}(r),!i?.has(e)&&!("object"!=typeof(a=t?.[m])||null===a||!("uat"in a)||"number"!=typeof a.uat||F()-a.uat>=300)&&"jwks"in a&&P(a.jwks)&&Array.isArray(a.jwks.keys)&&Array.prototype.every.call(a.jwks.keys,P)&&eW(e,t?.[m].jwks,t?.[m].uat),i?.has(e)){if({jwks:n,age:o}=i.get(e),o>=300)return eJ(e,t?.[m]),eO(e,t,r)}else n=await t_(e,t).then(tk),o=0,eW(e,n,F(),t?.[m]);switch(c.slice(0,2)){case"RS":case"PS":s="RSA";break;case"ES":s="EC";break;case"Ed":s="OKP";break;case"ML":s="AKP";break;default:throw new A("unsupported JWS algorithm",{cause:{alg:c}})}let p=n.keys.filter(e=>{if(e.kty!==s||void 0!==u&&u!==e.kid||void 0!==e.alg&&c!==e.alg||void 0!==e.use&&"sig"!==e.use||e.key_ops?.includes("verify")===!1)return!1;switch(!0){case"ES256"===c&&"P-256"!==e.crv:case"ES384"===c&&"P-384"!==e.crv:case"ES512"===c&&"P-521"!==e.crv:case"Ed25519"===c&&"Ed25519"!==e.crv:case"EdDSA"===c&&"Ed25519"!==e.crv:return!1}return!0}),{0:d,length:l}=p;if(!l){if(o>=60)return eJ(e,t?.[m]),eO(e,t,r);throw v("error when selecting a JWT verification key, no applicable keys found",td,{header:r,candidates:p,jwks_uri:new URL(e.jwks_uri)})}if(1!==l)throw v('error when selecting a JWT verification key, multiple applicable keys found, a "kid" JWT Header Parameter is required',td,{header:r,candidates:p,jwks_uri:new URL(e.jwks_uri)});return tB(c,d)}let eI=Symbol();function ex(e){return e.headers.get("content-type")?.split(";")[0]}async function eD(e,t,r,a,n){let i;if(q(e),V(t),!o(a,Response))throw u('"response" must be an instance of Response',c);if(ez(a),200!==a.status)throw v('"response" is not a conform UserInfo Endpoint response (unexpected HTTP status code)',ti,a);if(tA(a),"application/jwt"===ex(a)){let{claims:r,jwt:o}=await tK(await a.text(),tH.bind(void 0,t.userinfo_signed_response_alg,e.userinfo_signing_alg_values_supported,void 0),z(t),G(t),n?.[f]).then(eF.bind(void 0,t.client_id)).then(eV.bind(void 0,e));eN.set(a,o),i=r}else{if(t.userinfo_signed_response_alg)throw v("JWT UserInfo Response expected",tt,a);i=await t1(a)}if(I(i.sub,'"response" body "sub" property',ta,{body:i}),r===eI);else if(I(r,'"expectedSubject"'),i.sub!==r)throw v('unexpected "response" body "sub" property value',tp,{expected:r,body:i,attribute:"sub"});return i}async function eU(e,t,r,a,n,i,o){return await r(e,t,n,i),i.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),(o?.[h]||fetch)(a.href,{body:n,headers:Object.fromEntries(i.entries()),method:"POST",redirect:"manual",signal:K(a,o?.signal)})}async function eH(e,t,r,a,n,i){let o=ed(e,"token_endpoint",t.use_mtls_endpoint_aliases,i?.[p]!==!0);n.set("grant_type",a);let s=C(i?.headers);s.set("accept","application/json"),i?.DPoP!==void 0&&(eP(i.DPoP),await i.DPoP.addProof(o,s,"POST"));let c=await eU(e,t,r,o,n,s,i);return i?.DPoP?.cacheNonce(c,o),c}async function eL(e,t,r,a,n){q(e),V(t),I(a,'"refreshToken"');let i=new URLSearchParams(n?.additionalParameters);return i.set("refresh_token",a),eH(e,t,r,"refresh_token",i,n)}let ej=new WeakMap,eN=new WeakMap;function eM(e){if(!e.id_token)return;let t=ej.get(e);if(!t)throw u('"ref" was already garbage collected or did not resolve from the proper sources',s);return t}async function e$(e,t,r){let a;if(q(e),!eN.has(t))throw u('"ref" does not contain a processed JWT Response to verify the signature of',s);let{0:n,1:i,2:o}=eN.get(t).split("."),c=JSON.parse(E(S(n)));if(c.alg.startsWith("HS"))throw new A("unsupported JWS algorithm",{cause:{alg:c.alg}});a=await eO(e,r,c),await tC(n,i,a,S(o))}async function eB(e,t,r,a,n,i){if(q(e),V(t),!o(r,Response))throw u('"response" must be an instance of Response',c);await eR(r,200,"Token Endpoint"),tA(r);let s=await t1(r);if(I(s.access_token,'"response" body "access_token" property',ta,{body:s}),I(s.token_type,'"response" body "token_type" property',ta,{body:s}),s.token_type=s.token_type.toLowerCase(),void 0!==s.expires_in){let e="number"!=typeof s.expires_in?parseFloat(s.expires_in):s.expires_in;O(e,!0,'"response" body "expires_in" property',ta,{body:s}),s.expires_in=e}if(void 0!==s.refresh_token&&I(s.refresh_token,'"response" body "refresh_token" property',ta,{body:s}),void 0!==s.scope&&"string"!=typeof s.scope)throw v('"response" body "scope" property must be a string',ta,{body:s});if(void 0!==s.id_token){I(s.id_token,'"response" body "id_token" property',ta,{body:s});let i=["aud","exp","iat","iss","sub"];!0===t.require_auth_time&&i.push("auth_time"),void 0!==t.default_max_age&&(O(t.default_max_age,!0,'"client.default_max_age"'),i.push("auth_time")),a?.length&&i.push(...a);let{claims:o,jwt:c}=await tK(s.id_token,tH.bind(void 0,t.id_token_signed_response_alg,e.id_token_signing_alg_values_supported,"RS256"),z(t),G(t),n).then(e2.bind(void 0,i)).then(eX.bind(void 0,e)).then(eq.bind(void 0,t.client_id));if(Array.isArray(o.aud)&&1!==o.aud.length){if(void 0===o.azp)throw v('ID Token "aud" (audience) claim includes additional untrusted audiences',tu,{claims:o,claim:"aud"});if(o.azp!==t.client_id)throw v('unexpected ID Token "azp" (authorized party) claim value',tu,{expected:t.client_id,claims:o,claim:"azp"})}void 0!==o.auth_time&&O(o.auth_time,!0,'ID Token "auth_time" (authentication time)',ta,{claims:o}),eN.set(r,c),ej.set(s,o)}if(i?.[s.token_type]!==void 0)i[s.token_type](r,s);else if("dpop"!==s.token_type&&"bearer"!==s.token_type)throw new A("unsupported `token_type` value",{cause:{body:s}});return s}function ez(e){let t;if(t=function(e){if(!o(e,Response))throw u('"response" must be an instance of Response',c);let t=e.headers.get("www-authenticate");if(null===t)return;let r=[],a=t;for(;a;){let e,t=a.match(eS),n=t?.["1"].toLowerCase();if(!n)return;let i=a.substring(t[0].length);if(i&&!i.match(/^[\s,]/))return;let o=i.match(/^\s+(.*)$/),s=!!o;a=o?o[1]:void 0;let c={};if(s)for(;a;){let r,n;if(t=a.match(eA)){if([,r,n,a]=t,n.includes("\\"))try{n=JSON.parse(`"${n}"`)}catch{}c[r.toLowerCase()]=n;continue}if(t=a.match(eb)){[,r,n,a]=t,c[r.toLowerCase()]=n;continue}if(t=a.match(ev)){if(Object.keys(c).length)break;[,e,a]=t;break}return}else a=i||void 0;let u={scheme:n,parameters:c};e&&(u.token68=e),r.push(u)}if(r.length)return r}(e))throw new eg("server responded with a challenge in the WWW-Authenticate HTTP Header",{cause:t,response:e})}async function eG(e,t,r,a){return eB(e,t,r,void 0,a?.[f],a?.recognizedTokenTypes)}function eF(e,t){return void 0!==t.claims.aud?eq(e,t):t}function eq(e,t){if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(e))throw v('unexpected JWT "aud" (audience) claim value',tu,{expected:e,claims:t.claims,claim:"aud"})}else if(t.claims.aud!==e)throw v('unexpected JWT "aud" (audience) claim value',tu,{expected:e,claims:t.claims,claim:"aud"});return t}function eV(e,t){return void 0!==t.claims.iss?eX(e,t):t}function eX(e,t){let r=e[t5]?.(t)??e.issuer;if(t.claims.iss!==r)throw v('unexpected JWT "iss" (issuer) claim value',tu,{expected:r,claims:t.claims,claim:"iss"});return t}let eY=new WeakSet,eQ=Symbol();async function eZ(e,t,r,a,n,i,o){if(q(e),V(t),!eY.has(a))throw u('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()',s);I(n,'"redirectUri"');let c=tL(a,"code");if(!c)throw v('no authorization code in "callbackParameters"',ta);let p=new URLSearchParams(o?.additionalParameters);return p.set("redirect_uri",n),p.set("code",c),i!==eQ&&(I(i,'"codeVerifier"'),p.set("code_verifier",i)),eH(e,t,r,"authorization_code",p,o)}let e0={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation",auth_time:"authentication time"};function e2(e,t){for(let r of e)if(void 0===t.claims[r])throw v(`JWT "${r}" (${e0[r]}) claim missing`,ta,{claims:t.claims});return t}let e1=Symbol(),e6=Symbol();async function e5(e,t,r,a){return"string"==typeof a?.expectedNonce||"number"==typeof a?.maxAge||a?.requireIdToken?e8(e,t,r,a.expectedNonce,a.maxAge,a[f],a.recognizedTokenTypes):e4(e,t,r,a?.[f],a?.recognizedTokenTypes)}async function e8(e,t,r,a,n,i,o){let s=[];switch(a){case void 0:a=e1;break;case e1:break;default:I(a,'"expectedNonce" argument'),s.push("nonce")}switch(n??=t.default_max_age){case void 0:n=e6;break;case e6:break;default:O(n,!0,'"maxAge" argument'),s.push("auth_time")}let c=await eB(e,t,r,s,i,o);I(c.id_token,'"response" body "id_token" property',ta,{body:c});let u=eM(c);if(n!==e6){let e=F()+z(t),r=G(t);if(u.auth_time+n<e-r)throw v("too much time has elapsed since the last End-User authentication",tc,{claims:u,now:e,tolerance:r,claim:"auth_time"})}if(a===e1){if(void 0!==u.nonce)throw v('unexpected ID Token "nonce" claim value',tu,{expected:void 0,claims:u,claim:"nonce"})}else if(u.nonce!==a)throw v('unexpected ID Token "nonce" claim value',tu,{expected:a,claims:u,claim:"nonce"});return c}async function e4(e,t,r,a,n){let i=await eB(e,t,r,void 0,a,n),o=eM(i);if(o){if(void 0!==t.default_max_age){O(t.default_max_age,!0,'"client.default_max_age"');let e=F()+z(t),r=G(t);if(o.auth_time+t.default_max_age<e-r)throw v("too much time has elapsed since the last End-User authentication",tc,{claims:o,now:e,tolerance:r,claim:"auth_time"})}if(void 0!==o.nonce)throw v('unexpected ID Token "nonce" claim value',tu,{expected:void 0,claims:o,claim:"nonce"})}return i}let e3="OAUTH_WWW_AUTHENTICATE_CHALLENGE",e9="OAUTH_RESPONSE_BODY_ERROR",e7="OAUTH_UNSUPPORTED_OPERATION",te="OAUTH_AUTHORIZATION_RESPONSE_ERROR",tt="OAUTH_JWT_USERINFO_EXPECTED",tr="OAUTH_PARSE_ERROR",ta="OAUTH_INVALID_RESPONSE",tn="OAUTH_RESPONSE_IS_NOT_JSON",ti="OAUTH_RESPONSE_IS_NOT_CONFORM",to="OAUTH_HTTP_REQUEST_FORBIDDEN",ts="OAUTH_REQUEST_PROTOCOL_FORBIDDEN",tc="OAUTH_JWT_TIMESTAMP_CHECK_FAILED",tu="OAUTH_JWT_CLAIM_COMPARISON_FAILED",tp="OAUTH_JSON_ATTRIBUTE_COMPARISON_FAILED",td="OAUTH_KEY_SELECTION_FAILED",tl="OAUTH_MISSING_SERVER_METADATA",th="OAUTH_INVALID_SERVER_METADATA";function ty(e,t){if("string"!=typeof t.header.typ||t.header.typ.toLowerCase().replace(/^application\//,"")!==e)throw v('unexpected JWT "typ" header parameter value',ta,{header:t.header});return t}async function tf(e,t,r,a,n){return q(e),V(t),eH(e,t,r,"client_credentials",new URLSearchParams(a),n)}async function tm(e,t,r,a,n,i){return q(e),V(t),I(a,'"grantType"'),eH(e,t,r,a,new URLSearchParams(n),i)}async function tw(e,t,r,a){return eB(e,t,r,void 0,a?.[f],a?.recognizedTokenTypes)}async function tg(e,t,r,a){return eB(e,t,r,void 0,a?.[f],a?.recognizedTokenTypes)}async function tE(e,t,r,a,n){q(e),V(t),I(a,'"token"');let i=ed(e,"revocation_endpoint",t.use_mtls_endpoint_aliases,n?.[p]!==!0),o=new URLSearchParams(n?.additionalParameters);o.set("token",a);let s=C(n?.headers);return s.delete("accept"),eU(e,t,r,i,o,s,n)}async function tS(e){if(!o(e,Response))throw u('"response" must be an instance of Response',c);await eR(e,200,"Revocation Endpoint")}function tA(e){if(e.bodyUsed)throw u('"response" body has been used already',s)}async function tb(e,t,r,a,n){q(e),V(t),I(a,'"token"');let i=ed(e,"introspection_endpoint",t.use_mtls_endpoint_aliases,n?.[p]!==!0),o=new URLSearchParams(n?.additionalParameters);o.set("token",a);let s=C(n?.headers);return n?.requestJwtResponse??t.introspection_signed_response_alg?s.set("accept","application/token-introspection+jwt"):s.set("accept","application/json"),eU(e,t,r,i,o,s,n)}async function tv(e,t,r,a){let n;if(q(e),V(t),!o(r,Response))throw u('"response" must be an instance of Response',c);if(await eR(r,200,"Introspection Endpoint"),"application/token-introspection+jwt"===ex(r)){tA(r);let{claims:i,jwt:o}=await tK(await r.text(),tH.bind(void 0,t.introspection_signed_response_alg,e.introspection_signing_alg_values_supported,"RS256"),z(t),G(t),a?.[f]).then(ty.bind(void 0,"token-introspection+jwt")).then(e2.bind(void 0,["aud","iat","iss"])).then(eX.bind(void 0,e)).then(eq.bind(void 0,t.client_id));if(eN.set(r,o),!P(i.token_introspection))throw v('JWT "token_introspection" claim must be a JSON object',ta,{claims:i});n=i.token_introspection}else tA(r),n=await t1(r);if("boolean"!=typeof n.active)throw v('"response" body "active" property must be a boolean',ta,{body:n});return n}async function t_(e,t){q(e);let r=ed(e,"jwks_uri",!1,t?.[p]!==!0),a=C(t?.headers);return a.set("accept","application/json"),a.append("accept","application/jwk-set+json"),(t?.[h]||fetch)(r.href,{body:void 0,headers:Object.fromEntries(a.entries()),method:"GET",redirect:"manual",signal:K(r,t?.signal)})}async function tk(e){if(!o(e,Response))throw u('"response" must be an instance of Response',c);if(200!==e.status)throw v('"response" is not a conform JSON Web Key Set response (unexpected HTTP status code)',ti,e);tA(e);let t=await t1(e,e=>(function(e,...t){if(!t.includes(ex(e)))throw U(e,...t)})(e,"application/json","application/jwk-set+json"));if(!Array.isArray(t.keys))throw v('"response" body "keys" property must be an array',ta,{body:t});if(!Array.prototype.every.call(t.keys,P))throw v('"response" body "keys" property members must be JWK formatted objects',ta,{body:t});return t}function tR(e){let{algorithm:t}=e;if("number"!=typeof t.modulusLength||t.modulusLength<2048)throw new A(`unsupported ${t.name} modulusLength`,{cause:e})}function tP(e){switch(e.algorithm.name){case"ECDSA":return{name:e.algorithm.name,hash:function(e){let{algorithm:t}=e;switch(t.namedCurve){case"P-256":return"SHA-256";case"P-384":return"SHA-384";case"P-521":return"SHA-512";default:throw new A("unsupported ECDSA namedCurve",{cause:e})}}(e)};case"RSA-PSS":switch(tR(e),e.algorithm.hash.name){case"SHA-256":case"SHA-384":case"SHA-512":return{name:e.algorithm.name,saltLength:parseInt(e.algorithm.hash.name.slice(-3),10)>>3};default:throw new A("unsupported RSA-PSS hash name",{cause:e})}case"RSASSA-PKCS1-v1_5":return tR(e),e.algorithm.name;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":case"Ed25519":return e.algorithm.name}throw new A("unsupported CryptoKey algorithm name",{cause:e})}async function tC(e,t,r,a){let n=E(`${e}.${t}`),i=tP(r);if(!await crypto.subtle.verify(i,r,a,n))throw v("JWT signature verification failed",ta,{key:r,data:n,signature:a,algorithm:i})}async function tK(e,t,r,a,n){let i,o,{0:s,1:c,length:u}=e.split(".");if(5===u)if(void 0!==n)e=await n(e),{0:s,1:c,length:u}=e.split(".");else throw new A("JWE decryption is not configured",{cause:e});if(3!==u)throw v("Invalid JWT",ta,e);try{i=JSON.parse(E(S(s)))}catch(e){throw v("failed to parse JWT Header body as base64url encoded JSON",tr,e)}if(!P(i))throw v("JWT Header must be a top level object",ta,e);if(t(i),void 0!==i.crit)throw new A('no JWT "crit" header parameter extensions are supported',{cause:{header:i}});try{o=JSON.parse(E(S(c)))}catch(e){throw v("failed to parse JWT Payload body as base64url encoded JSON",tr,e)}if(!P(o))throw v("JWT Payload must be a top level object",ta,e);let p=F()+r;if(void 0!==o.exp){if("number"!=typeof o.exp)throw v('unexpected JWT "exp" (expiration time) claim type',ta,{claims:o});if(o.exp<=p-a)throw v('unexpected JWT "exp" (expiration time) claim value, expiration is past current timestamp',tc,{claims:o,now:p,tolerance:a,claim:"exp"})}if(void 0!==o.iat&&"number"!=typeof o.iat)throw v('unexpected JWT "iat" (issued at) claim type',ta,{claims:o});if(void 0!==o.iss&&"string"!=typeof o.iss)throw v('unexpected JWT "iss" (issuer) claim type',ta,{claims:o});if(void 0!==o.nbf){if("number"!=typeof o.nbf)throw v('unexpected JWT "nbf" (not before) claim type',ta,{claims:o});if(o.nbf>p+a)throw v('unexpected JWT "nbf" (not before) claim value',tc,{claims:o,now:p,tolerance:a,claim:"nbf"})}if(void 0!==o.aud&&"string"!=typeof o.aud&&!Array.isArray(o.aud))throw v('unexpected JWT "aud" (audience) claim type',ta,{claims:o});return{header:i,claims:o,jwt:e}}async function tT(e,t,r,a,n){if(q(e),V(t),r instanceof URL&&(r=r.searchParams),!(r instanceof URLSearchParams))throw u('"parameters" must be an instance of URLSearchParams, or URL',c);let i=tL(r,"response");if(!i)throw v('"parameters" does not contain a JARM response',ta);let{claims:o,header:s,jwt:p}=await tK(i,tH.bind(void 0,t.authorization_signed_response_alg,e.authorization_signing_alg_values_supported,"RS256"),z(t),G(t),n?.[f]).then(e2.bind(void 0,["aud","exp","iss"])).then(eX.bind(void 0,e)).then(eq.bind(void 0,t.client_id)),{0:d,1:l,2:h}=p.split("."),y=S(h),m=await eO(e,n,s);await tC(d,l,m,y);let w=new URLSearchParams;for(let[e,t]of Object.entries(o))"string"==typeof t&&"aud"!==e&&w.set(e,t);return tM(e,t,w,a)}async function tW(e,t,r){let a;switch(t.alg){case"RS256":case"PS256":case"ES256":a="SHA-256";break;case"RS384":case"PS384":case"ES384":a="SHA-384";break;case"RS512":case"PS512":case"ES512":case"Ed25519":case"EdDSA":a="SHA-512";break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":a={name:"cSHAKE256",length:512};break;default:throw new A(`unsupported JWS algorithm for ${r} calculation`,{cause:{alg:t.alg}})}let n=await crypto.subtle.digest(a,E(e));return S(n.slice(0,n.byteLength/2))}async function tJ(e,t,r,a){return t===await tW(e,r,a)}async function tO(e,t,r,a,n,i,o){return tU(e,t,r,a,n,i,o,!0)}async function tI(e,t,r,a,n,i,o){return tU(e,t,r,a,n,i,o,!1)}async function tx(e){if(e.bodyUsed)throw u("form_post Request instances must contain a readable body",s,{cause:e});return e.text()}async function tD(e){if("POST"!==e.method)throw u("form_post responses are expected to use the POST method",s,{cause:e});if("application/x-www-form-urlencoded"!==ex(e))throw u("form_post responses are expected to use the application/x-www-form-urlencoded content-type",s,{cause:e});return tx(e)}async function tU(e,t,r,a,n,i,p,d){if(q(e),V(t),r instanceof URL){if(!r.hash.length)throw u('"parameters" as an instance of URL must contain a hash (fragment) with the Authorization Response parameters',s);r=new URLSearchParams(r.hash.slice(1))}else if(o(r,Request))r=new URLSearchParams(await tD(r));else if(r instanceof URLSearchParams)r=new URLSearchParams(r);else throw u('"parameters" must be an instance of URLSearchParams, URL, or Response',c);let l=tL(r,"id_token");switch(r.delete("id_token"),n){case void 0:case tN:break;default:I(n,'"expectedState" argument')}let h=tM({...e,authorization_response_iss_parameter_supported:!1},t,r,n);if(!l)throw v('"parameters" does not contain an ID Token',ta);let y=tL(r,"code");if(!y)throw v('"parameters" does not contain an Authorization Code',ta);let m=["aud","exp","iat","iss","sub","nonce","c_hash"],w=r.get("state");d&&("string"==typeof n||null!==w)&&m.push("s_hash"),void 0!==i?O(i,!0,'"maxAge" argument'):void 0!==t.default_max_age&&O(t.default_max_age,!0,'"client.default_max_age"'),i??=t.default_max_age??e6,(t.require_auth_time||i!==e6)&&m.push("auth_time");let{claims:g,header:E,jwt:A}=await tK(l,tH.bind(void 0,t.id_token_signed_response_alg,e.id_token_signing_alg_values_supported,"RS256"),z(t),G(t),p?.[f]).then(e2.bind(void 0,m)).then(eX.bind(void 0,e)).then(eq.bind(void 0,t.client_id)),b=z(t),_=F()+b;if(g.iat<_-3600)throw v('unexpected JWT "iat" (issued at) claim value, it is too far in the past',tc,{now:_,claims:g,claim:"iat"});if(I(g.c_hash,'ID Token "c_hash" (code hash) claim value',ta,{claims:g}),void 0!==g.auth_time&&O(g.auth_time,!0,'ID Token "auth_time" (authentication time)',ta,{claims:g}),i!==e6){let e=F()+z(t),r=G(t);if(g.auth_time+i<e-r)throw v("too much time has elapsed since the last End-User authentication",tc,{claims:g,now:e,tolerance:r,claim:"auth_time"})}if(I(a,'"expectedNonce" argument'),g.nonce!==a)throw v('unexpected ID Token "nonce" claim value',tu,{expected:a,claims:g,claim:"nonce"});if(Array.isArray(g.aud)&&1!==g.aud.length){if(void 0===g.azp)throw v('ID Token "aud" (audience) claim includes additional untrusted audiences',tu,{claims:g,claim:"aud"});if(g.azp!==t.client_id)throw v('unexpected ID Token "azp" (authorized party) claim value',tu,{expected:t.client_id,claims:g,claim:"azp"})}let{0:k,1:R,2:P}=A.split("."),C=S(P),K=await eO(e,p,E);if(await tC(k,R,K,C),await tJ(y,g.c_hash,E,"c_hash")!==!0)throw v('invalid ID Token "c_hash" (code hash) claim value',tu,{code:y,alg:E.alg,claim:"c_hash",claims:g});if((d&&null!==w||void 0!==g.s_hash)&&(I(g.s_hash,'ID Token "s_hash" (state hash) claim value',ta,{claims:g}),I(w,'"state" response parameter',ta,{parameters:r}),await tJ(w,g.s_hash,E,"s_hash")!==!0))throw v('invalid ID Token "s_hash" (state hash) claim value',tu,{state:w,alg:E.alg,claim:"s_hash",claims:g});return h}function tH(e,t,r,a){if(void 0!==e){if("string"==typeof e?a.alg!==e:!e.includes(a.alg))throw v('unexpected JWT "alg" header parameter',ta,{header:a,expected:e,reason:"client configuration"});return}if(Array.isArray(t)){if(!t.includes(a.alg))throw v('unexpected JWT "alg" header parameter',ta,{header:a,expected:t,reason:"authorization server metadata"});return}if(void 0!==r){if("string"==typeof r?a.alg!==r:"function"==typeof r?!r(a.alg):!r.includes(a.alg))throw v('unexpected JWT "alg" header parameter',ta,{header:a,expected:r,reason:"default value"});return}throw v('missing client or server configuration to verify used JWT "alg" header parameter',void 0,{client:e,issuer:t,fallback:r})}function tL(e,t){let{0:r,length:a}=e.getAll(t);if(a>1)throw v(`"${t}" parameter must be provided only once`,ta);return r}let tj=Symbol(),tN=Symbol();function tM(e,t,r,a){var n;if(q(e),V(t),r instanceof URL&&(r=r.searchParams),!(r instanceof URLSearchParams))throw u('"parameters" must be an instance of URLSearchParams, or URL',c);if(tL(r,"response"))throw v('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()',ta,{parameters:r});let i=tL(r,"iss"),o=tL(r,"state");if(!i&&e.authorization_response_iss_parameter_supported)throw v('response parameter "iss" (issuer) missing',ta,{parameters:r});if(i&&i!==e.issuer)throw v('unexpected "iss" (issuer) response parameter value',ta,{expected:e.issuer,parameters:r});switch(a){case void 0:case tN:if(void 0!==o)throw v('unexpected "state" response parameter encountered',ta,{expected:void 0,parameters:r});break;case tj:break;default:if(I(a,'"expectedState" argument'),o!==a)throw v(void 0===o?'response parameter "state" missing':'unexpected "state" response parameter value',ta,{expected:a,parameters:r})}if(tL(r,"error"))throw new ew("authorization response from the server is an error",{cause:r});let s=tL(r,"id_token"),p=tL(r,"token");if(void 0!==s||void 0!==p)throw new A("implicit and hybrid flows are not supported");return n=new URLSearchParams(r),eY.add(n),n}function t$(e){switch(e){case"PS256":case"PS384":case"PS512":return{name:"RSA-PSS",hash:`SHA-${e.slice(-3)}`};case"RS256":case"RS384":case"RS512":return{name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.slice(-3)}`};case"ES256":case"ES384":return{name:"ECDSA",namedCurve:`P-${e.slice(-3)}`};case"ES512":return{name:"ECDSA",namedCurve:"P-521"};case"EdDSA":return"Ed25519";case"Ed25519":case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return e;default:throw new A("unsupported JWS algorithm",{cause:{alg:e}})}}async function tB(e,t){let{ext:r,key_ops:a,use:n,...i}=t;return crypto.subtle.importKey("jwk",i,t$(e),!0,["verify"])}async function tz(e,t,r,a,n){q(e),V(t);let i=ed(e,"device_authorization_endpoint",t.use_mtls_endpoint_aliases,n?.[p]!==!0),o=new URLSearchParams(a);o.set("client_id",t.client_id);let s=C(n?.headers);return s.set("accept","application/json"),eU(e,t,r,i,o,s,n)}async function tG(e,t,r){if(q(e),V(t),!o(r,Response))throw u('"response" must be an instance of Response',c);await eR(r,200,"Device Authorization Endpoint"),tA(r);let a=await t1(r);I(a.device_code,'"response" body "device_code" property',ta,{body:a}),I(a.user_code,'"response" body "user_code" property',ta,{body:a}),I(a.verification_uri,'"response" body "verification_uri" property',ta,{body:a});let n="number"!=typeof a.expires_in?parseFloat(a.expires_in):a.expires_in;return O(n,!0,'"response" body "expires_in" property',ta,{body:a}),a.expires_in=n,void 0!==a.verification_uri_complete&&I(a.verification_uri_complete,'"response" body "verification_uri_complete" property',ta,{body:a}),void 0!==a.interval&&O(a.interval,!1,'"response" body "interval" property',ta,{body:a}),a}async function tF(e,t,r,a,n){q(e),V(t),I(a,'"deviceCode"');let i=new URLSearchParams(n?.additionalParameters);return i.set("device_code",a),eH(e,t,r,"urn:ietf:params:oauth:grant-type:device_code",i,n)}async function tq(e,t,r,a){return eB(e,t,r,void 0,a?.[f],a?.recognizedTokenTypes)}async function tV(e,t){I(e,'"alg"');let r=t$(e);return(e.startsWith("PS")||e.startsWith("RS"))&&Object.assign(r,{modulusLength:t?.modulusLength??2048,publicExponent:new Uint8Array([1,0,1])}),crypto.subtle.generateKey(r,t?.extractable??!1,["sign","verify"])}async function tX(e,t,r,a,n){q(e),V(t);let i=ed(e,"backchannel_authentication_endpoint",t.use_mtls_endpoint_aliases,n?.[p]!==!0),o=new URLSearchParams(a);o.set("client_id",t.client_id);let s=C(n?.headers);return s.set("accept","application/json"),eU(e,t,r,i,o,s,n)}async function tY(e,t,r){if(q(e),V(t),!o(r,Response))throw u('"response" must be an instance of Response',c);await eR(r,200,"Backchannel Authentication Endpoint"),tA(r);let a=await t1(r);I(a.auth_req_id,'"response" body "auth_req_id" property',ta,{body:a});let n="number"!=typeof a.expires_in?parseFloat(a.expires_in):a.expires_in;return O(n,!0,'"response" body "expires_in" property',ta,{body:a}),a.expires_in=n,void 0!==a.interval&&O(a.interval,!1,'"response" body "interval" property',ta,{body:a}),a}async function tQ(e,t,r,a,n){q(e),V(t),I(a,'"authReqId"');let i=new URLSearchParams(n?.additionalParameters);return i.set("auth_req_id",a),eH(e,t,r,"urn:openid:params:grant-type:ciba",i,n)}async function tZ(e,t,r,a){return eB(e,t,r,void 0,a?.[f],a?.recognizedTokenTypes)}async function t0(e,t,r){q(e);let a=ed(e,"registration_endpoint",t.use_mtls_endpoint_aliases,r?.[p]!==!0),n=C(r?.headers);n.set("accept","application/json"),n.set("content-type","application/json");let i="POST";r?.DPoP&&(eP(r.DPoP),await r.DPoP.addProof(a,n,i,r.initialAccessToken)),r?.initialAccessToken&&n.set("authorization",`${n.has("dpop")?"DPoP":"Bearer"} ${r.initialAccessToken}`);let o=await (r?.[h]||fetch)(a.href,{body:JSON.stringify(t),headers:Object.fromEntries(n.entries()),method:i,redirect:"manual",signal:K(a,r?.signal)});return r?.DPoP?.cacheNonce(o,a),o}async function t2(e){if(!o(e,Response))throw u('"response" must be an instance of Response',c);await eR(e,201,"Dynamic Client Registration Endpoint"),tA(e);let t=await t1(e);return I(t.client_id,'"response" body "client_id" property',ta,{body:t}),void 0!==t.client_secret&&I(t.client_secret,'"response" body "client_secret" property',ta,{body:t}),t.client_secret&&O(t.client_secret_expires_at,!0,'"response" body "client_secret_expires_at" property',ta,{body:t}),t}async function t1(e,t=D){let r;try{r=await e.json()}catch(r){throw t(e),v('failed to parse "response" body as JSON',tr,r)}if(!P(r))throw v('"response" body must be a top level object',ta,{body:r});return r}let t6=Symbol(),t5=Symbol();e.s(["AuthorizationResponseError",()=>ew,"ClientSecretBasic",()=>Q,"ClientSecretJwt",()=>et,"ClientSecretPost",()=>Y,"DPoP",()=>ef,"HTTP_REQUEST_FORBIDDEN",0,to,"INVALID_RESPONSE",0,ta,"JSON_ATTRIBUTE_COMPARISON",0,tp,"JWT_CLAIM_COMPARISON",0,tu,"JWT_TIMESTAMP_CHECK",0,tc,"None",()=>er,"OperationProcessingError",()=>b,"PARSE_ERROR",0,tr,"PrivateKeyJwt",()=>ee,"REQUEST_PROTOCOL_FORBIDDEN",0,ts,"RESPONSE_IS_NOT_CONFORM",0,ti,"RESPONSE_IS_NOT_JSON",0,tn,"ResponseBodyError",()=>em,"TlsClientAuth",()=>ea,"UNSUPPORTED_OPERATION",0,e7,"UnsupportedOperationError",()=>A,"WWWAuthenticateChallengeError",()=>eg,"_expectedIssuer",0,t5,"_nodiscoverycheck",0,t6,"allowInsecureRequests",0,p,"authorizationCodeGrantRequest",()=>eZ,"backchannelAuthenticationGrantRequest",()=>tQ,"backchannelAuthenticationRequest",()=>tX,"calculatePKCECodeChallenge",()=>M,"checkProtocol",()=>eu,"clientCredentialsGrantRequest",()=>tf,"clockSkew",0,d,"clockTolerance",0,l,"customFetch",0,h,"deviceAuthorizationRequest",()=>tz,"deviceCodeGrantRequest",()=>tF,"discoveryRequest",()=>J,"dynamicClientRegistrationRequest",()=>t0,"formPostResponse",()=>tD,"generateKeyPair",()=>tV,"generateRandomCodeVerifier",()=>L,"generateRandomNonce",()=>N,"generateRandomState",()=>j,"genericTokenEndpointRequest",()=>tm,"getContentType",()=>ex,"getValidatedIdTokenClaims",()=>eM,"introspectionRequest",()=>tb,"isDPoPNonceError",()=>ey,"issueRequestObject",()=>ei,"jweDecrypt",0,f,"jwksCache",0,m,"modifyAssertion",0,y,"nopkce",0,eQ,"processAuthorizationCodeResponse",()=>e5,"processBackchannelAuthenticationGrantResponse",()=>tZ,"processBackchannelAuthenticationResponse",()=>tY,"processClientCredentialsResponse",()=>tg,"processDeviceAuthorizationResponse",()=>tG,"processDeviceCodeResponse",()=>tq,"processDiscoveryResponse",()=>x,"processDynamicClientRegistrationResponse",()=>t2,"processGenericTokenEndpointResponse",()=>tw,"processIntrospectionResponse",()=>tv,"processPushedAuthorizationResponse",()=>e_,"processRefreshTokenResponse",()=>eG,"processRevocationResponse",()=>tS,"processUserInfoResponse",()=>eD,"protectedResourceRequest",()=>eK,"pushedAuthorizationRequest",()=>el,"refreshTokenGrantRequest",()=>eL,"resolveEndpoint",()=>ed,"revocationRequest",()=>tE,"skipStateCheck",0,tj,"skipSubjectCheck",0,eI,"userInfoRequest",()=>eT,"validateApplicationLevelSignature",()=>e$,"validateAuthResponse",()=>tM,"validateCodeIdTokenResponse",()=>tI,"validateDetachedSignatureResponse",()=>tO,"validateJwtAuthResponse",()=>tT])},663370,632802,477468,865466,743332,943080,684405,906695,14184,196821,e=>{"use strict";let t=new TextEncoder,r=new TextDecoder;function a(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;for(let a of e)t.set(a,r),r+=a.length;return t}function n(e,t,r){if(t<0||t>=0x100000000)throw RangeError(`value must be >= 0 and <= ${0x100000000-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function i(e){let t=Math.floor(e/0x100000000),r=new Uint8Array(8);return n(r,t,0),n(r,e%0x100000000,4),r}function o(e){let t=new Uint8Array(4);return n(t,e),t}function s(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++){let a=e.charCodeAt(r);if(a>127)throw TypeError("non-ASCII string encountered in encode()");t[r]=a}return t}function c(e){if(Uint8Array.prototype.toBase64)return e.toBase64();let t=[];for(let r=0;r<e.length;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return btoa(t.join(""))}function u(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(e);let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}function p(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof e?e:r.decode(e),{alphabet:"base64url"});let t=e;t instanceof Uint8Array&&(t=r.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/");try{return u(t)}catch{throw TypeError("The input to be decoded is not correctly encoded.")}}function d(e){let r=e;return("string"==typeof r&&(r=t.encode(r)),Uint8Array.prototype.toBase64)?r.toBase64({alphabet:"base64url",omitPadding:!0}):c(r).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}e.s(["concat",()=>a,"decoder",0,r,"encode",()=>s,"encoder",0,t,"uint32be",()=>o,"uint64be",()=>i],632802),e.s(["decodeBase64",()=>u,"encodeBase64",()=>c],477468),e.s(["decode",()=>p,"encode",()=>d],663370);class l extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class h extends l{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(e,t,r="unspecified",a="unspecified"){super(e,{cause:{claim:r,reason:a,payload:t}}),this.claim=r,this.reason=a,this.payload=t}}class y extends l{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(e,t,r="unspecified",a="unspecified"){super(e,{cause:{claim:r,reason:a,payload:t}}),this.claim=r,this.reason=a,this.payload=t}}class f extends l{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class m extends l{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class w extends l{static code="ERR_JWE_DECRYPTION_FAILED";code="ERR_JWE_DECRYPTION_FAILED";constructor(e="decryption operation failed",t){super(e,t)}}class g extends l{static code="ERR_JWE_INVALID";code="ERR_JWE_INVALID"}class E extends l{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class S extends l{static code="ERR_JWK_INVALID";code="ERR_JWK_INVALID"}class A extends l{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t)}}function b(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new m(`Unsupported JWE Algorithm: ${e}`)}}function v(e,t){if(t.length<<3!==b(e))throw new g("Invalid Initialization Vector length")}function _(e,t){let r=e.byteLength<<3;if(r!==t)throw new g(`Invalid Content Encryption Key length. Expected ${t} bits, got ${r} bits`)}e.s(["JOSEAlgNotAllowed",()=>f,"JOSEError",()=>l,"JOSENotSupported",()=>m,"JWEDecryptionFailed",()=>w,"JWEInvalid",()=>g,"JWKInvalid",()=>S,"JWTClaimValidationFailed",()=>h,"JWTExpired",()=>y,"JWTInvalid",()=>E],865466),e.s(["bitLength",()=>b,"generateIv",0,e=>crypto.getRandomValues(new Uint8Array(b(e)>>3))],743332),e.s(["checkIvLength",()=>v],943080),e.s(["checkCekLength",()=>_],684405);let k=(e,t="algorithm.name")=>TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`);function R(e,t,r){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if("AES-GCM"!==e.algorithm.name)throw k("AES-GCM");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw k(r,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if("AES-KW"!==e.algorithm.name)throw k("AES-KW");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw k(r,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":break;default:throw k("ECDH or X25519")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if("PBKDF2"!==e.algorithm.name)throw k("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if("RSA-OAEP"!==e.algorithm.name)throw k("RSA-OAEP");let r=parseInt(t.slice(9),10)||1;if(parseInt(e.algorithm.hash.name.slice(4),10)!==r)throw k(`SHA-${r}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}if(r&&!e.usages.includes(r))throw TypeError(`CryptoKey does not support this operation, its usages must include ${r}.`)}function P(e,t,...r){if((r=r.filter(Boolean)).length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}function C(e){if(!K(e))throw Error("CryptoKey instance expected")}e.s(["checkEncCryptoKey",()=>R],906695),e.s(["invalidKeyInput",0,(e,...t)=>P("Key must be ",e,...t),"withAlg",0,(e,t,...r)=>P(`Key for the ${e} algorithm must be `,t,...r)],14184);let K=e=>{if(e?.[Symbol.toStringTag]==="CryptoKey")return!0;try{return e instanceof CryptoKey}catch{return!1}},T=e=>e?.[Symbol.toStringTag]==="KeyObject";e.s(["assertCryptoKey",()=>C,"isCryptoKey",0,K,"isKeyLike",0,e=>K(e)||T(e),"isKeyObject",0,T],196821)},653906,e=>{"use strict";var t=e.i(632802),r=e.i(943080),a=e.i(684405),n=e.i(865466),i=e.i(906695),o=e.i(14184),s=e.i(196821);async function c(e,t){if(!(e instanceof Uint8Array))throw TypeError("First argument must be a buffer");if(!(t instanceof Uint8Array))throw TypeError("Second argument must be a buffer");let r={name:"HMAC",hash:"SHA-256"},a=await crypto.subtle.generateKey(r,!1,["sign"]),n=new Uint8Array(await crypto.subtle.sign(r,a,e)),i=new Uint8Array(await crypto.subtle.sign(r,a,t)),o=0,s=-1;for(;++s<32;)o|=n[s]^i[s];return 0===o}async function u(e,r,a,i,s,u){let p,d;if(!(r instanceof Uint8Array))throw TypeError((0,o.invalidKeyInput)(r,"Uint8Array"));let l=parseInt(e.slice(1,4),10),h=await crypto.subtle.importKey("raw",r.subarray(l>>3),"AES-CBC",!1,["decrypt"]),y=await crypto.subtle.importKey("raw",r.subarray(0,l>>3),{hash:`SHA-${l<<1}`,name:"HMAC"},!1,["sign"]),f=(0,t.concat)(u,i,a,(0,t.uint64be)(u.length<<3)),m=new Uint8Array((await crypto.subtle.sign("HMAC",y,f)).slice(0,l>>3));try{p=await c(s,m)}catch{}if(!p)throw new n.JWEDecryptionFailed;try{d=new Uint8Array(await crypto.subtle.decrypt({iv:i,name:"AES-CBC"},h,a))}catch{}if(!d)throw new n.JWEDecryptionFailed;return d}async function p(e,r,a,o,s,c){let u;r instanceof Uint8Array?u=await crypto.subtle.importKey("raw",r,"AES-GCM",!1,["decrypt"]):((0,i.checkEncCryptoKey)(r,e,"decrypt"),u=r);try{return new Uint8Array(await crypto.subtle.decrypt({additionalData:c,iv:o,name:"AES-GCM",tagLength:128},u,(0,t.concat)(a,s)))}catch{throw new n.JWEDecryptionFailed}}async function d(e,t,i,c,d,l){if(!(0,s.isCryptoKey)(t)&&!(t instanceof Uint8Array))throw TypeError((0,o.invalidKeyInput)(t,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));if(!c)throw new n.JWEInvalid("JWE Initialization Vector missing");if(!d)throw new n.JWEInvalid("JWE Authentication Tag missing");switch((0,r.checkIvLength)(e,c),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return t instanceof Uint8Array&&(0,a.checkCekLength)(t,parseInt(e.slice(-3),10)),u(e,t,i,c,d,l);case"A128GCM":case"A192GCM":case"A256GCM":return t instanceof Uint8Array&&(0,a.checkCekLength)(t,parseInt(e.slice(1,4),10)),p(e,t,i,c,d,l);default:throw new n.JOSENotSupported("Unsupported JWE Content Encryption Algorithm")}}e.s(["decrypt",()=>d])},971083,e=>{"use strict";function t(...e){let r,a=e.filter(Boolean);if(0===a.length||1===a.length)return!0;for(let e of a){let t=Object.keys(e);if(!r||0===r.size){r=new Set(t);continue}for(let e of t){if(r.has(e))return!1;r.add(e)}}return!0}e.s(["isDisjoint",()=>t])},842020,e=>{"use strict";function t(e){if("object"!=typeof e||null===e||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}e.s(["isObject",()=>t])},41752,155630,61953,250735,402867,e=>{"use strict";var t=e.i(906695);function r(e,t){if(e.algorithm.length!==parseInt(t.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${t}`)}function a(e,r,a){return e instanceof Uint8Array?crypto.subtle.importKey("raw",e,"AES-KW",!0,[a]):((0,t.checkEncCryptoKey)(e,r,a),e)}async function n(e,t,n){let i=await a(t,e,"wrapKey");r(i,e);let o=await crypto.subtle.importKey("raw",n,{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.wrapKey("raw",o,i,"AES-KW"))}async function i(e,t,n){let i=await a(t,e,"unwrapKey");r(i,e);let o=await crypto.subtle.unwrapKey("raw",n,i,"AES-KW",{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.exportKey("raw",o))}e.s(["unwrap",()=>i,"wrap",()=>n],41752);var o=e.i(632802);async function s(e,t){let r=`SHA-${e.slice(-3)}`;return new Uint8Array(await crypto.subtle.digest(r,t))}function c(e){return(0,o.concat)((0,o.uint32be)(e.length),e)}async function u(e,t,r){let a=t>>3,n=Math.ceil(a/32),i=new Uint8Array(32*n);for(let t=1;t<=n;t++){let a=new Uint8Array(4+e.length+r.length);a.set((0,o.uint32be)(t),0),a.set(e,4),a.set(r,4+e.length);let n=await s("sha256",a);i.set(n,(t-1)*32)}return i.slice(0,a)}async function p(e,r,a,n,i=new Uint8Array,s=new Uint8Array){var d;(0,t.checkEncCryptoKey)(e,"ECDH"),(0,t.checkEncCryptoKey)(r,"ECDH","deriveBits");let l=c((0,o.encode)(a)),h=c(i),y=c(s),f=(0,o.uint32be)(n),m=new Uint8Array,w=(0,o.concat)(l,h,y,f,m);return u(new Uint8Array(await crypto.subtle.deriveBits({name:e.algorithm.name,public:e},r,"X25519"===(d=e).algorithm.name?256:Math.ceil(parseInt(d.algorithm.namedCurve.slice(-3),10)/8)<<3)),n,w)}function d(e){switch(e.algorithm.namedCurve){case"P-256":case"P-384":case"P-521":return!0;default:return"X25519"===e.algorithm.name}}e.s(["digest",()=>s],155630),e.s(["allowed",()=>d,"deriveKey",()=>p],61953);var l=e.i(663370),h=e.i(865466);async function y(e,r,a,n){if(!(e instanceof Uint8Array)||e.length<8)throw new h.JWEInvalid("PBES2 Salt Input must be 8 or more octets");let i=(0,o.concat)((0,o.encode)(r),Uint8Array.of(0),e),s=parseInt(r.slice(13,16),10),c={hash:`SHA-${r.slice(8,11)}`,iterations:a,name:"PBKDF2",salt:i},u=await (n instanceof Uint8Array?crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveBits"]):((0,t.checkEncCryptoKey)(n,r,"deriveBits"),n));return new Uint8Array(await crypto.subtle.deriveBits(c,u,s))}async function f(e,t,r,a=2048,i=crypto.getRandomValues(new Uint8Array(16))){let o=await y(i,e,a,t);return{encryptedKey:await n(e.slice(-6),o,r),p2c:a,p2s:(0,l.encode)(i)}}async function m(e,t,r,a,n){let o=await y(n,e,a,t);return i(e.slice(-6),o,r)}function w(e,t){if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:r}=t.algorithm;if("number"!=typeof r||r<2048)throw TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}}e.s(["unwrap",()=>m,"wrap",()=>f],250735);let g=e=>{switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new h.JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`)}};async function E(e,r,a){return(0,t.checkEncCryptoKey)(r,e,"encrypt"),w(e,r),new Uint8Array(await crypto.subtle.encrypt(g(e),r,a))}async function S(e,r,a){return(0,t.checkEncCryptoKey)(r,e,"decrypt"),w(e,r),new Uint8Array(await crypto.subtle.decrypt(g(e),r,a))}e.s(["decrypt",()=>S,"encrypt",()=>E],402867)},413777,108456,e=>{"use strict";var t=e.i(865466);function r(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new t.JOSENotSupported(`Unsupported JWE Algorithm: ${e}`)}}e.s(["cekLength",()=>r,"generateCek",0,e=>crypto.getRandomValues(new Uint8Array(r(e)>>3))],413777);var a=e.i(14184),n=e.i(477468),i=e.i(196821);let o=(e,t)=>{let r=(e.match(/.{1,64}/g)||[]).join("\n");return`-----BEGIN ${t}-----
${r}
-----END ${t}-----`},s=async(e,t,r)=>{if((0,i.isKeyObject)(r)){if(r.type!==e)throw TypeError(`key is not a ${e} key`);return r.export({format:"pem",type:t})}if(!(0,i.isCryptoKey)(r))throw TypeError((0,a.invalidKeyInput)(r,"CryptoKey","KeyObject"));if(!r.extractable)throw TypeError("CryptoKey is not extractable");if(r.type!==e)throw TypeError(`key is not a ${e} key`);return o((0,n.encodeBase64)(new Uint8Array(await crypto.subtle.exportKey(t,r))),`${e.toUpperCase()} KEY`)},c=(e,t)=>{if(e.byteLength!==t.length)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},u=e=>({data:e,pos:0}),p=e=>{let t=e.data[e.pos++];if(128&t){let r=127&t,a=0;for(let t=0;t<r;t++)a=a<<8|e.data[e.pos++];return a}return t},d=(e,t=1)=>{if(t<=0)return;e.pos++;let r=p(e);e.pos+=r,t>1&&d(e,t-1)},l=(e,t,r)=>{if(e.data[e.pos++]!==t)throw Error(r)},h=(e,t)=>{let r=e.data.subarray(e.pos,e.pos+t);return e.pos+=t,r},y=e=>{let t,r=(l(e,6,"Expected algorithm OID"),t=p(e),h(e,t));if(c(r,[43,101,110]))return"X25519";if(!c(r,[42,134,72,206,61,2,1]))throw Error("Unsupported key algorithm");l(e,6,"Expected curve OID");let a=p(e),n=h(e,a);for(let{name:e,oid:t}of[{name:"P-256",oid:[42,134,72,206,61,3,1,7]},{name:"P-384",oid:[43,129,4,0,34]},{name:"P-521",oid:[43,129,4,0,35]}])if(c(n,t))return e;throw Error("Unsupported named curve")},f=async(e,r,a,n)=>{let i,o,s="spki"===e,c=()=>s?["verify"]:["sign"];switch(a){case"PS256":case"PS384":case"PS512":i={name:"RSA-PSS",hash:`SHA-${a.slice(-3)}`},o=c();break;case"RS256":case"RS384":case"RS512":i={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${a.slice(-3)}`},o=c();break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":i={name:"RSA-OAEP",hash:`SHA-${parseInt(a.slice(-3),10)||1}`},o=s?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":case"ES384":case"ES512":i={name:"ECDSA",namedCurve:({ES256:"P-256",ES384:"P-384",ES512:"P-521"})[a]},o=c();break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":try{let e=n.getNamedCurve(r);i="X25519"===e?{name:"X25519"}:{name:"ECDH",namedCurve:e}}catch(e){throw new t.JOSENotSupported("Invalid or unsupported key format")}o=s?[]:["deriveBits"];break;case"Ed25519":case"EdDSA":i={name:"Ed25519"},o=c();break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":i={name:a},o=c();break;default:throw new t.JOSENotSupported('Invalid or unsupported "alg" (Algorithm) value')}return crypto.subtle.importKey(e,r,i,n?.extractable??!!s,o)},m=(e,t)=>(0,n.decodeBase64)(e.replace(t,"")),w=(e,t,r)=>{let a=m(e,/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g),n=r;return t?.startsWith?.("ECDH-ES")&&((n||={}).getNamedCurve=e=>{let t=u(e);return l(t,48,"Invalid SPKI structure"),p(t),l(t,48,"Expected algorithm identifier"),p(t),t.pos,y(t)}),f("spki",a,t,n)};e.s(["fromPKCS8",0,(e,t,r)=>{let a=m(e,/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g),n=r;return t?.startsWith?.("ECDH-ES")&&((n||={}).getNamedCurve=e=>{let t,r=u(e);return l(r,48,"Invalid PKCS#8 structure"),p(r),l(r,2,"Expected version field"),t=p(r),r.pos+=t,l(r,48,"Expected algorithm identifier"),p(r),r.pos,y(r)}),f("pkcs8",a,t,n)},"fromSPKI",0,w,"fromX509",0,(e,t,r)=>{let a;try{var i;let t,r,n;t=u(i=m(e,/(?:-----(?:BEGIN|END) CERTIFICATE-----|\s)/g)),l(t,48,"Invalid certificate structure"),p(t),l(t,48,"Invalid tbsCertificate structure"),p(t),160===i[t.pos]?d(t,6):d(t,5),r=t.pos,l(t,48,"Invalid SPKI structure"),n=p(t),a=i.subarray(r,r+n+(t.pos-r))}catch(e){throw TypeError("Failed to parse the X.509 certificate",{cause:e})}return w(o((0,n.encodeBase64)(a),"PUBLIC KEY"),t,r)},"toPKCS8",0,e=>s("private","pkcs8",e),"toSPKI",0,e=>s("public","spki",e)],108456)},177942,e=>{"use strict";var t=e.i(865466);async function r(e){if(!e.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:r,keyUsages:a}=function(e){let r,a;switch(e.kty){case"AKP":switch(e.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":r={name:e.alg},a=e.priv?["sign"]:["verify"];break;default:throw new t.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":r={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},a=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":r={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},a=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":r={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},a=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new t.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":r={name:"ECDSA",namedCurve:"P-256"},a=e.d?["sign"]:["verify"];break;case"ES384":r={name:"ECDSA",namedCurve:"P-384"},a=e.d?["sign"]:["verify"];break;case"ES512":r={name:"ECDSA",namedCurve:"P-521"},a=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":r={name:"ECDH",namedCurve:e.crv},a=e.d?["deriveBits"]:[];break;default:throw new t.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"Ed25519":case"EdDSA":r={name:"Ed25519"},a=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":r={name:e.crv},a=e.d?["deriveBits"]:[];break;default:throw new t.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new t.JOSENotSupported('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:r,keyUsages:a}}(e),n={...e};return"AKP"!==n.kty&&delete n.alg,delete n.use,crypto.subtle.importKey("jwk",n,r,e.ext??(!e.d&&!e.priv),e.key_ops??a)}e.s(["jwkToKey",()=>r])},397554,e=>{"use strict";var t=e.i(663370);e.i(108456);var r=e.i(177942),a=e.i(865466),n=e.i(842020);async function i(e,i,o){let s;if(!(0,n.isObject)(e))throw TypeError("JWK must be an object");switch(i??=e.alg,s??=o?.extractable??e.ext,e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return(0,t.decode)(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new a.JOSENotSupported('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return(0,r.jwkToKey)({...e,alg:i,ext:s});case"AKP":if("string"!=typeof e.alg||!e.alg)throw TypeError('missing "alg" (Algorithm) Parameter value');if(void 0!==i&&i!==e.alg)throw TypeError("JWK alg and alg option value mismatch");return(0,r.jwkToKey)({...e,ext:s});case"EC":case"OKP":return(0,r.jwkToKey)({...e,alg:i,ext:s});default:throw new a.JOSENotSupported('Unsupported "kty" (Key Type) Parameter value')}}e.s(["importJWK",()=>i])},774260,e=>{"use strict";var t=e.i(632802),r=e.i(943080),a=e.i(684405),n=e.i(906695),i=e.i(14184),o=e.i(743332),s=e.i(865466),c=e.i(196821);async function u(e,r,a,n,o){if(!(a instanceof Uint8Array))throw TypeError((0,i.invalidKeyInput)(a,"Uint8Array"));let s=parseInt(e.slice(1,4),10),c=await crypto.subtle.importKey("raw",a.subarray(s>>3),"AES-CBC",!1,["encrypt"]),u=await crypto.subtle.importKey("raw",a.subarray(0,s>>3),{hash:`SHA-${s<<1}`,name:"HMAC"},!1,["sign"]),p=new Uint8Array(await crypto.subtle.encrypt({iv:n,name:"AES-CBC"},c,r)),d=(0,t.concat)(o,n,p,(0,t.uint64be)(o.length<<3));return{ciphertext:p,tag:new Uint8Array((await crypto.subtle.sign("HMAC",u,d)).slice(0,s>>3)),iv:n}}async function p(e,t,r,a,i){let o;r instanceof Uint8Array?o=await crypto.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt"]):((0,n.checkEncCryptoKey)(r,e,"encrypt"),o=r);let s=new Uint8Array(await crypto.subtle.encrypt({additionalData:i,iv:a,name:"AES-GCM",tagLength:128},o,t)),c=s.slice(-16);return{ciphertext:s.slice(0,-16),tag:c,iv:a}}async function d(e,t,n,d,l){if(!(0,c.isCryptoKey)(n)&&!(n instanceof Uint8Array))throw TypeError((0,i.invalidKeyInput)(n,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));switch(d?(0,r.checkIvLength)(e,d):d=(0,o.generateIv)(e),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return n instanceof Uint8Array&&(0,a.checkCekLength)(n,parseInt(e.slice(-3),10)),u(e,t,n,d,l);case"A128GCM":case"A192GCM":case"A256GCM":return n instanceof Uint8Array&&(0,a.checkCekLength)(n,parseInt(e.slice(1,4),10)),p(e,t,n,d,l);default:throw new s.JOSENotSupported("Unsupported JWE Content Encryption Algorithm")}}e.s(["encrypt",()=>d])},206024,e=>{"use strict";var t=e.i(774260),r=e.i(653906),a=e.i(663370);async function n(e,r,n,i){let o=e.slice(0,7),s=await (0,t.encrypt)(o,n,r,i,new Uint8Array);return{encryptedKey:s.ciphertext,iv:(0,a.encode)(s.iv),tag:(0,a.encode)(s.tag)}}async function i(e,t,a,n,i){let o=e.slice(0,7);return(0,r.decrypt)(o,t,a,n,i,new Uint8Array)}e.s(["unwrap",()=>i,"wrap",()=>n])},869419,e=>{"use strict";var t=e.i(41752),r=e.i(61953),a=e.i(250735),n=e.i(402867),i=e.i(663370),o=e.i(865466),s=e.i(413777),c=e.i(397554),u=e.i(842020),p=e.i(206024),d=e.i(196821);async function l(e,l,h,y,f){switch(e){case"dir":if(void 0!==h)throw new o.JWEInvalid("Encountered unexpected JWE Encrypted Key");return l;case"ECDH-ES":if(void 0!==h)throw new o.JWEInvalid("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let a,n;if(!(0,u.isObject)(y.epk))throw new o.JWEInvalid('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if((0,d.assertCryptoKey)(l),!r.allowed(l))throw new o.JOSENotSupported("ECDH with the provided key is not allowed or not supported by your javascript runtime");let p=await (0,c.importJWK)(y.epk,e);if((0,d.assertCryptoKey)(p),void 0!==y.apu){if("string"!=typeof y.apu)throw new o.JWEInvalid('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{a=(0,i.decode)(y.apu)}catch{throw new o.JWEInvalid("Failed to base64url decode the apu")}}if(void 0!==y.apv){if("string"!=typeof y.apv)throw new o.JWEInvalid('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{n=(0,i.decode)(y.apv)}catch{throw new o.JWEInvalid("Failed to base64url decode the apv")}}let f=await r.deriveKey(p,l,"ECDH-ES"===e?y.enc:e,"ECDH-ES"===e?(0,s.cekLength)(y.enc):parseInt(e.slice(-5,-2),10),a,n);if("ECDH-ES"===e)return f;if(void 0===h)throw new o.JWEInvalid("JWE Encrypted Key missing");return t.unwrap(e.slice(-6),f,h)}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===h)throw new o.JWEInvalid("JWE Encrypted Key missing");return(0,d.assertCryptoKey)(l),n.decrypt(e,l,h);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let t;if(void 0===h)throw new o.JWEInvalid("JWE Encrypted Key missing");if("number"!=typeof y.p2c)throw new o.JWEInvalid('JOSE Header "p2c" (PBES2 Count) missing or invalid');let r=f?.maxPBES2Count||1e4;if(y.p2c>r)throw new o.JWEInvalid('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof y.p2s)throw new o.JWEInvalid('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{t=(0,i.decode)(y.p2s)}catch{throw new o.JWEInvalid("Failed to base64url decode the p2s")}return a.unwrap(e,l,h,y.p2c,t)}case"A128KW":case"A192KW":case"A256KW":if(void 0===h)throw new o.JWEInvalid("JWE Encrypted Key missing");return t.unwrap(e,l,h);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let t,r;if(void 0===h)throw new o.JWEInvalid("JWE Encrypted Key missing");if("string"!=typeof y.iv)throw new o.JWEInvalid('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof y.tag)throw new o.JWEInvalid('JOSE Header "tag" (Authentication Tag) missing or invalid');try{t=(0,i.decode)(y.iv)}catch{throw new o.JWEInvalid("Failed to base64url decode the iv")}try{r=(0,i.decode)(y.tag)}catch{throw new o.JWEInvalid("Failed to base64url decode the tag")}return(0,p.unwrap)(e,l,h,t,r)}default:throw new o.JOSENotSupported('Invalid or unsupported "alg" (JWE Algorithm) header value')}}e.s(["decryptKeyManagement",()=>l])},252665,e=>{"use strict";var t=e.i(865466);function r(e,r,a,n,i){let o;if(void 0!==i.crit&&n?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||void 0===n.crit)return new Set;if(!Array.isArray(n.crit)||0===n.crit.length||n.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let s of(o=void 0!==a?new Map([...Object.entries(a),...r.entries()]):r,n.crit)){if(!o.has(s))throw new t.JOSENotSupported(`Extension Header Parameter "${s}" is not recognized`);if(void 0===i[s])throw new e(`Extension Header Parameter "${s}" is missing`);if(o.get(s)&&void 0===n[s])throw new e(`Extension Header Parameter "${s}" MUST be integrity protected`)}return new Set(n.crit)}e.s(["validateCrit",()=>r])},146996,e=>{"use strict";function t(e,t){if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)}e.s(["validateAlgorithms",()=>t])},463159,e=>{"use strict";var t=e.i(842020);e.s(["isJWK",0,e=>(0,t.isObject)(e)&&"string"==typeof e.kty,"isPrivateJWK",0,e=>"oct"!==e.kty&&("AKP"===e.kty&&"string"==typeof e.priv||"string"==typeof e.d),"isPublicJWK",0,e=>"oct"!==e.kty&&void 0===e.d&&void 0===e.priv,"isSecretJWK",0,e=>"oct"===e.kty&&"string"==typeof e.k])},18083,e=>{"use strict";let t;var r=e.i(463159),a=e.i(663370),n=e.i(177942),i=e.i(196821);let o=async(e,r,a,i=!1)=>{let o=(t||=new WeakMap).get(e);if(o?.[a])return o[a];let s=await (0,n.jwkToKey)({...r,alg:a});return i&&Object.freeze(e),o?o[a]=s:t.set(e,{[a]:s}),s};async function s(e,n){if(e instanceof Uint8Array||(0,i.isCryptoKey)(e))return e;if((0,i.isKeyObject)(e)){if("secret"===e.type)return e.export();if("toCryptoKey"in e&&"function"==typeof e.toCryptoKey)try{return((e,r)=>{let a,n=(t||=new WeakMap).get(e);if(n?.[r])return n[r];let i="public"===e.type,o=!!i;if("x25519"===e.asymmetricKeyType){switch(r){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}a=e.toCryptoKey(e.asymmetricKeyType,o,i?[]:["deriveBits"])}if("ed25519"===e.asymmetricKeyType){if("EdDSA"!==r&&"Ed25519"!==r)throw TypeError("given KeyObject instance cannot be used for this algorithm");a=e.toCryptoKey(e.asymmetricKeyType,o,[i?"verify":"sign"])}switch(e.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(r!==e.asymmetricKeyType.toUpperCase())throw TypeError("given KeyObject instance cannot be used for this algorithm");a=e.toCryptoKey(e.asymmetricKeyType,o,[i?"verify":"sign"])}if("rsa"===e.asymmetricKeyType){let t;switch(r){case"RSA-OAEP":t="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":t="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":t="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":t="SHA-512";break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}if(r.startsWith("RSA-OAEP"))return e.toCryptoKey({name:"RSA-OAEP",hash:t},o,i?["encrypt"]:["decrypt"]);a=e.toCryptoKey({name:r.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:t},o,[i?"verify":"sign"])}if("ec"===e.asymmetricKeyType){let t=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(e.asymmetricKeyDetails?.namedCurve);if(!t)throw TypeError("given KeyObject instance cannot be used for this algorithm");"ES256"===r&&"P-256"===t&&(a=e.toCryptoKey({name:"ECDSA",namedCurve:t},o,[i?"verify":"sign"])),"ES384"===r&&"P-384"===t&&(a=e.toCryptoKey({name:"ECDSA",namedCurve:t},o,[i?"verify":"sign"])),"ES512"===r&&"P-521"===t&&(a=e.toCryptoKey({name:"ECDSA",namedCurve:t},o,[i?"verify":"sign"])),r.startsWith("ECDH-ES")&&(a=e.toCryptoKey({name:"ECDH",namedCurve:t},o,i?[]:["deriveBits"]))}if(!a)throw TypeError("given KeyObject instance cannot be used for this algorithm");return n?n[r]=a:t.set(e,{[r]:a}),a})(e,n)}catch(e){if(e instanceof TypeError)throw e}let r=e.export({format:"jwk"});return o(e,r,n)}if((0,r.isJWK)(e))return e.k?(0,a.decode)(e.k):o(e,e,n,!0);throw Error("unreachable")}e.s(["normalizeKey",()=>s])},48215,e=>{"use strict";var t=e.i(14184),r=e.i(196821),a=e.i(463159);let n=e=>e?.[Symbol.toStringTag],i=(e,t,r)=>{if(void 0!==t.use){let e;switch(r){case"sign":case"verify":e="sig";break;case"encrypt":case"decrypt":e="enc"}if(t.use!==e)throw TypeError(`Invalid key for this operation, its "use" must be "${e}" when present`)}if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, its "alg" must be "${e}" when present`);if(Array.isArray(t.key_ops)){let a;switch(!0){case"sign"===r||"verify"===r:case"dir"===e:case e.includes("CBC-HS"):a=r;break;case e.startsWith("PBES2"):a="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(e):a=!e.includes("GCM")&&e.endsWith("KW")?"encrypt"===r?"wrapKey":"unwrapKey":r;break;case"encrypt"===r&&e.startsWith("RSA"):a="wrapKey";break;case"decrypt"===r:a=e.startsWith("RSA")?"unwrapKey":"deriveBits"}if(a&&t.key_ops?.includes?.(a)===!1)throw TypeError(`Invalid key for this operation, its "key_ops" must include "${a}" when present`)}return!0};function o(e,o,s){switch(e.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":((e,o,s)=>{if(!(o instanceof Uint8Array)){if(a.isJWK(o)){if(a.isSecretJWK(o)&&i(e,o,s))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!(0,r.isKeyLike)(o))throw TypeError((0,t.withAlg)(e,o,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if("secret"!==o.type)throw TypeError(`${n(o)} instances for symmetric algorithms must be of type "secret"`)}})(e,o,s);break;default:((e,o,s)=>{if(a.isJWK(o))switch(s){case"decrypt":case"sign":if(a.isPrivateJWK(o)&&i(e,o,s))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"encrypt":case"verify":if(a.isPublicJWK(o)&&i(e,o,s))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!(0,r.isKeyLike)(o))throw TypeError((0,t.withAlg)(e,o,"CryptoKey","KeyObject","JSON Web Key"));if("secret"===o.type)throw TypeError(`${n(o)} instances for asymmetric algorithms must not be of type "secret"`);if("public"===o.type)switch(s){case"sign":throw TypeError(`${n(o)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw TypeError(`${n(o)} instances for asymmetric algorithm decryption must be of type "private"`)}if("private"===o.type)switch(s){case"verify":throw TypeError(`${n(o)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw TypeError(`${n(o)} instances for asymmetric algorithm encryption must be of type "public"`)}})(e,o,s)}}e.s(["checkKeyType",()=>o])},121493,e=>{"use strict";var t=e.i(663370),r=e.i(653906),a=e.i(865466),n=e.i(971083),i=e.i(842020),o=e.i(869419),s=e.i(632802),c=e.i(413777),u=e.i(252665),p=e.i(146996),d=e.i(18083),l=e.i(48215);async function h(e,h,y){let f,m,w,g,E,S,A;if(!(0,i.isObject)(e))throw new a.JWEInvalid("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new a.JWEInvalid("JOSE Header missing");if(void 0!==e.iv&&"string"!=typeof e.iv)throw new a.JWEInvalid("JWE Initialization Vector incorrect type");if("string"!=typeof e.ciphertext)throw new a.JWEInvalid("JWE Ciphertext missing or incorrect type");if(void 0!==e.tag&&"string"!=typeof e.tag)throw new a.JWEInvalid("JWE Authentication Tag incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new a.JWEInvalid("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new a.JWEInvalid("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new a.JWEInvalid("JWE AAD incorrect type");if(void 0!==e.header&&!(0,i.isObject)(e.header))throw new a.JWEInvalid("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!(0,i.isObject)(e.unprotected))throw new a.JWEInvalid("JWE Per-Recipient Unprotected Header incorrect type");if(e.protected)try{let r=(0,t.decode)(e.protected);f=JSON.parse(s.decoder.decode(r))}catch{throw new a.JWEInvalid("JWE Protected Header is invalid")}if(!(0,n.isDisjoint)(f,e.header,e.unprotected))throw new a.JWEInvalid("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let b={...f,...e.header,...e.unprotected};if((0,u.validateCrit)(a.JWEInvalid,new Map,y?.crit,f,b),void 0!==b.zip)throw new a.JOSENotSupported('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:v,enc:_}=b;if("string"!=typeof v||!v)throw new a.JWEInvalid("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof _||!_)throw new a.JWEInvalid("missing JWE Encryption Algorithm (enc) in JWE Header");let k=y&&(0,p.validateAlgorithms)("keyManagementAlgorithms",y.keyManagementAlgorithms),R=y&&(0,p.validateAlgorithms)("contentEncryptionAlgorithms",y.contentEncryptionAlgorithms);if(k&&!k.has(v)||!k&&v.startsWith("PBES2"))throw new a.JOSEAlgNotAllowed('"alg" (Algorithm) Header Parameter value not allowed');if(R&&!R.has(_))throw new a.JOSEAlgNotAllowed('"enc" (Encryption Algorithm) Header Parameter value not allowed');if(void 0!==e.encrypted_key)try{m=(0,t.decode)(e.encrypted_key)}catch{throw new a.JWEInvalid("Failed to base64url decode the encrypted_key")}let P=!1;"function"==typeof h&&(h=await h(f,e),P=!0),(0,l.checkKeyType)("dir"===v?_:v,h,"decrypt");let C=await (0,d.normalizeKey)(h,v);try{w=await (0,o.decryptKeyManagement)(v,C,m,b,y)}catch(e){if(e instanceof TypeError||e instanceof a.JWEInvalid||e instanceof a.JOSENotSupported)throw e;w=(0,c.generateCek)(_)}if(void 0!==e.iv)try{g=(0,t.decode)(e.iv)}catch{throw new a.JWEInvalid("Failed to base64url decode the iv")}if(void 0!==e.tag)try{E=(0,t.decode)(e.tag)}catch{throw new a.JWEInvalid("Failed to base64url decode the tag")}let K=void 0!==e.protected?(0,s.encode)(e.protected):new Uint8Array;S=void 0!==e.aad?(0,s.concat)(K,(0,s.encode)("."),(0,s.encode)(e.aad)):K;try{A=(0,t.decode)(e.ciphertext)}catch{throw new a.JWEInvalid("Failed to base64url decode the ciphertext")}let T={plaintext:await (0,r.decrypt)(_,w,A,g,E,S)};if(void 0!==e.protected&&(T.protectedHeader=f),void 0!==e.aad)try{T.additionalAuthenticatedData=(0,t.decode)(e.aad)}catch{throw new a.JWEInvalid("Failed to base64url decode the aad")}return(void 0!==e.unprotected&&(T.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(T.unprotectedHeader=e.header),P)?{...T,key:C}:T}async function y(e,t,r){if(e instanceof Uint8Array&&(e=s.decoder.decode(e)),"string"!=typeof e)throw new a.JWEInvalid("Compact JWE must be a string or Uint8Array");let{0:n,1:i,2:o,3:c,4:u,length:p}=e.split(".");if(5!==p)throw new a.JWEInvalid("Invalid Compact JWE");let d=await h({ciphertext:c,iv:o||void 0,protected:n,tag:u||void 0,encrypted_key:i||void 0},t,r),l={plaintext:d.plaintext,protectedHeader:d.protectedHeader};return"function"==typeof t?{...l,key:d.key}:l}e.s(["compactDecrypt",()=>y],121493)}];

//# sourceMappingURL=node_modules_f36205eb._.js.map