module.exports=[563810,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(747315),f=a.i(782317),g=a.i(57641),h=a.i(973784),i=a.i(875139),j=a.i(588463),k=a.i(856068),l=a.i(416941),m=a.i(626233),n=a.i(241484),o=a.i(875168),p=a.i(178769),q=a.i(648577),r=a.i(649450),s=a.i(77928),t=a.i(105528),u=a.i(50944);function v({open:a,onClose:v,resourceName:w,namespace:x,resourceType:y="deployment"}){let{selectedRepo:z,setPendingPR:A}=(0,t.useGitHubStore)(),B=(0,t.useModeStore)(a=>a.mode),C=(0,u.useRouter)(),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)(""),[L,M]=(0,c.useState)(!1),[N,O]=(0,c.useState)(null),[P,Q]=(0,c.useState)(null),[R,S]=(0,c.useState)(!1),[T,U]=(0,c.useState)(!1),[V,W]=(0,c.useState)(null),[X,Y]=(0,c.useState)([]),[Z,$]=(0,c.useState)(!1),{data:_}=(0,d.useQuery)({queryKey:["github-auth-status"],queryFn:async()=>{let a=await fetch("/api/github/auth-status");return a.ok?a.json():{authenticated:!1}},enabled:a}),{data:aa,isLoading:ab}=(0,d.useQuery)({queryKey:["github-files",z?.owner,z?.repo],queryFn:async()=>{if(!z)return[];let a=await fetch(`/api/github/files?owner=${z.owner}&repo=${z.repo}&ref=${z.branch}`);if(!a.ok)throw Error("Failed to fetch files");return a.json()},enabled:!!z&&a});(0,c.useEffect)(()=>{_&&Q(_.authenticated)},[_]),(0,c.useEffect)(()=>{(async()=>{if(aa&&0!==aa.length&&!D&&a&&z){U(!0),W(null);try{let a,b=localStorage.getItem("kubevista_openai_key");if(b){let c=w.replace(/-(main|dev|prod|staging|test)$/,""),d=c.toLowerCase().split(/[-_]/),e=aa.filter(a=>{let b=a.path.toLowerCase(),e=c.toLowerCase();return b.includes(e)||b.includes(w.toLowerCase())||d.some(a=>a.length>2&&b.includes(a))||b.includes("helm-release")||b.includes("application")||b.includes("deployment")||b.includes("kustomization")||b.includes(y)});e.length>50&&(e=e.slice(0,50));let f=e.length>0?e:aa.slice(0,100);a=await fetch("/api/ai/match-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({resourceName:w,namespace:x,resourceType:y,files:f.map(a=>({path:a.path,name:a.name})),apiKey:b})})}else{let a=w.replace(/-(main|dev|prod|staging|test)$/,""),b=aa.find(b=>{let c=b.path.toLowerCase(),d=a.toLowerCase(),e=w.toLowerCase();return c.includes(`${d}/helm-release.yaml`)||c.includes(`${d}/application.yaml`)||c.includes(`${e}/helm-release.yaml`)||c.includes(`${e}/application.yaml`)||c.includes(d)&&(c.includes("helm-release")||c.includes("application"))});if(b){await ac(b.path),W({method:"pattern",confidence:75,reasoning:"Matched by file path pattern"}),U(!1);return}console.warn("[YamlEditor] No match found with simple pattern matching"),U(!1);return}if(!a.ok){let b=await a.text();console.error("[YamlEditor] Failed to match file:",a.status,b);return}let c=await a.json();if(b&&c.matches)Y(c.matches),c.matches.length>1?($(!0),W({method:"ai",confidence:c.matches[0]?.confidence,reasoning:`Found ${c.matches.length} possible matches`})):1===c.matches.length?(W({method:"ai",confidence:c.matches[0].confidence,reasoning:c.matches[0].reasoning}),await ac(c.matches[0].file)):console.warn("[YamlEditor] No matches found");else{let a=b?c.matchedFile:c.matchedFile?.path;a?(W({method:b?"ai":c.method||"pattern",confidence:c.confidence,reasoning:c.reasoning}),await ac(a)):console.warn("[YamlEditor] No match found")}}catch(a){console.error("Error matching file:",a)}finally{U(!1)}}})()},[aa,a]);let ac=async a=>{if(z)try{let b=await fetch(`/api/github/file?owner=${z.owner}&repo=${z.repo}&path=${a}&ref=${z.branch}`);if(!b.ok)throw Error("Failed to load file");let c=await b.json();G(c.content),I(c.content),K(c.sha),E(a)}catch(a){console.error("Failed to load file:",a)}},ad=async()=>{if(z&&D){M(!0);try{let a=await fetch("/api/github/create-pr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({owner:z.owner,repo:z.repo,filePath:D,content:F,deploymentName:w,namespace:x,baseBranch:z.branch})});if(!a.ok){let b=await a.json();throw Error(b.error||"Failed to create PR")}let b=await a.json();O(b.pr),A(w,x,b.pr.number)}catch(a){console.error("Failed to create PR:",a),alert(a instanceof Error?a.message:"Failed to create PR")}finally{M(!1)}}};if(!1===P)return(0,b.jsxs)(e.default,{open:a,onClose:v,maxWidth:"sm",fullWidth:!0,children:[(0,b.jsx)(g.default,{children:(0,b.jsx)(q.default,{severity:"info",children:"Please connect your GitHub account in Settings first."})}),(0,b.jsx)(h.default,{children:(0,b.jsx)(i.default,{onClick:v,children:"Close"})})]});if(null===P)return(0,b.jsx)(e.default,{open:a,onClose:v,maxWidth:"sm",fullWidth:!0,children:(0,b.jsx)(g.default,{children:(0,b.jsx)(j.default,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,b.jsx)(p.default,{})})})});if(!z)return(0,b.jsxs)(e.default,{open:a,onClose:v,maxWidth:"sm",fullWidth:!0,children:[(0,b.jsx)(g.default,{children:(0,b.jsxs)(q.default,{severity:"info",children:[(0,b.jsx)(k.default,{variant:"body2",fontWeight:500,gutterBottom:!0,children:"No GitHub repository configured"}),(0,b.jsx)(k.default,{variant:"caption",color:"text.secondary",display:"block",sx:{mb:2},children:"Install the GitHub App and select a repository to edit YAML files via GitOps."}),(0,b.jsxs)(j.default,{sx:{display:"flex",gap:1},children:[(0,b.jsx)(i.default,{variant:"contained",size:"small",startIcon:(0,b.jsx)(r.default,{}),onClick:()=>{},children:"Install GitHub App"}),(0,b.jsx)(i.default,{variant:"outlined",size:"small",onClick:()=>{v(),C.push("demo"===B?"/demo/settings?tab=1":"/settings?tab=1")},children:"Go to Settings"})]})]})}),(0,b.jsx)(h.default,{children:(0,b.jsx)(i.default,{onClick:v,children:"Close"})})]});let ae=async()=>{if(z&&N){S(!0);try{let a=await fetch("/api/github/merge-pr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({owner:z.owner,repo:z.repo,pullNumber:N.number,mergeMethod:"merge"})});if(!a.ok){let b=await a.json();throw Error(b.error||"Failed to merge PR")}alert(`PR #${N.number} merged successfully!`),v(),window.location.reload()}catch(a){console.error("Failed to merge PR:",a),alert(a instanceof Error?a.message:"Failed to merge PR")}finally{S(!1)}}};return N?(0,b.jsxs)(e.default,{open:a,onClose:v,maxWidth:"md",fullWidth:!0,children:[(0,b.jsx)(f.default,{children:"Pull Request Created Successfully! ðŸŽ‰"}),(0,b.jsxs)(g.default,{children:[(0,b.jsxs)(q.default,{severity:"success",sx:{mb:2},children:["PR #",N.number," has been created and is ready for review."]}),(0,b.jsxs)(k.default,{variant:"body2",color:"text.secondary",sx:{mb:2},children:[(0,b.jsx)("strong",{children:"PR URL:"})," ",N.url]}),(0,b.jsxs)(q.default,{severity:"info",sx:{mb:2},children:[(0,b.jsx)(k.default,{variant:"body2",fontWeight:"bold",gutterBottom:!0,children:"What would you like to do?"}),(0,b.jsxs)(k.default,{variant:"caption",display:"block",children:["â€¢ ",(0,b.jsx)("strong",{children:"View PR"}),": Open the PR on GitHub to see details and review"]}),(0,b.jsxs)(k.default,{variant:"caption",display:"block",children:["â€¢ ",(0,b.jsx)("strong",{children:"Merge Now"}),": Merge the PR immediately (use with caution!)"]}),(0,b.jsxs)(k.default,{variant:"caption",display:"block",children:["â€¢ ",(0,b.jsx)("strong",{children:"Close"}),": Close this dialog and merge the PR later"]})]})]}),(0,b.jsxs)(h.default,{sx:{px:3,pb:2,gap:1},children:[(0,b.jsx)(i.default,{onClick:v,variant:"outlined",size:"large",children:"Close"}),(0,b.jsx)(i.default,{onClick:()=>window.open(N.url,"_blank"),variant:"outlined",size:"large",children:"View PR on GitHub"}),(0,b.jsx)(i.default,{onClick:ae,variant:"contained",color:"success",size:"large",disabled:R,startIcon:R?(0,b.jsx)(p.default,{size:20}):null,children:R?"Merging...":"Merge Now"})]})]}):(0,b.jsxs)(e.default,{open:a,onClose:v,maxWidth:"lg",fullWidth:!0,children:[(0,b.jsxs)(f.default,{children:["Edit YAML - ",w," (","configmap"===y?"ConfigMap":"secret"===y?"Secret":"Deployment",")"]}),(0,b.jsx)(g.default,{children:ab||T?(0,b.jsxs)(j.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2,p:4},children:[(0,b.jsx)(p.default,{}),(0,b.jsx)(k.default,{variant:"body2",color:"text.secondary",children:T?"Finding best matching file...":"Loading files..."})]}):(0,b.jsxs)(b.Fragment,{children:[V&&(0,b.jsxs)(q.default,{severity:"content"===V.method||"exact"===V.method||"directory"===V.method||"ai"===V.method?"success":"info",sx:{mb:2},children:[(0,b.jsxs)(k.default,{variant:"body2",children:["ai"===V.method&&`âœ“ File matched by AI (confidence: ${V.confidence}%)`,"content"===V.method&&"âœ“ File matched by cluster YAML comparison (exact match!)","exact"===V.method&&"âœ“ File automatically matched by exact name","directory"===V.method&&"âœ“ File automatically matched by directory structure","namespace"===V.method&&"âœ“ File automatically matched by namespace pattern","fuzzy"===V.method&&"âœ“ File automatically matched by similarity","pattern"===V.method&&"âœ“ File automatically matched by pattern matching"]}),V.reasoning&&(0,b.jsx)(k.default,{variant:"caption",display:"block",sx:{mt:.5,opacity:.8},children:V.reasoning})]}),Z&&X.length>0&&(0,b.jsxs)(j.default,{sx:{mb:2},children:[(0,b.jsx)(k.default,{variant:"subtitle2",gutterBottom:!0,children:"AI found multiple possible matches. Select the environment you want to edit:"}),(0,b.jsx)(j.default,{sx:{display:"flex",flexDirection:"column",gap:1},children:X.map(a=>(0,b.jsx)(i.default,{variant:D===a.file?"contained":"outlined",onClick:async()=>{$(!1),W({method:"ai",confidence:a.confidence,reasoning:a.reasoning}),await ac(a.file)},sx:{justifyContent:"flex-start",textAlign:"left",py:1.5,px:2},children:(0,b.jsxs)(j.default,{sx:{flex:1},children:[(0,b.jsxs)(k.default,{variant:"body2",fontWeight:600,children:[a.environment.toUpperCase()," - ",a.file.split("/").pop()]}),(0,b.jsx)(k.default,{variant:"caption",color:"text.secondary",display:"block",children:a.file}),(0,b.jsxs)(k.default,{variant:"caption",color:"text.secondary",display:"block",sx:{mt:.5},children:["Confidence: ",a.confidence,"% â€¢ ",a.reasoning]})]})},a.file))})]}),(0,b.jsxs)(n.default,{fullWidth:!0,sx:{mb:2},children:[(0,b.jsx)(o.default,{children:"Select YAML File"}),(0,b.jsx)(l.default,{value:D||"",onChange:a=>ac(a.target.value),label:"Select YAML File",children:aa?.map(a=>(0,b.jsx)(m.default,{value:a.path,children:a.path},a.path))})]}),D&&(0,b.jsx)(j.default,{sx:{border:1,borderColor:"divider",borderRadius:1},children:(0,b.jsx)(s.default,{height:"500px",defaultLanguage:"yaml",value:F,onChange:a=>G(a||""),theme:"vs-dark",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",wordWrap:"on",scrollBeyondLastLine:!1}})})]})}),(0,b.jsxs)(h.default,{children:[(0,b.jsx)(i.default,{onClick:v,children:"Cancel"}),(0,b.jsx)(i.default,{onClick:ad,variant:"contained",disabled:!D||F===H||L,children:L?"Creating PR...":"Create Pull Request"})]})]})}a.s(["YamlEditorModal",()=>v])}];

//# sourceMappingURL=app_app_components_yaml-editor_yaml-editor-modal_tsx_8a526c00._.js.map