module.exports=[178907,a=>{"use strict";var b=a.i(187924),c=a.i(856068),d=a.i(588463),e=a.i(648577),f=a.i(178769),g=a.i(744365),h=a.i(627049),i=a.i(436970),j=a.i(881923),k=a.i(732008),l=a.i(844968),m=a.i(36982);a.i(358405);var n=a.i(918319),o=a.i(213469),p=a.i(956824),q=a.i(935377),r=a.i(182879),s=a.i(92090),t=a.i(259518),u=a.i(238246),v=a.i(572131),w=a.i(50944),x=a.i(47830),y=a.i(288924),z=a.i(184252),A=a.i(47313),B=a.i(778081),C=a.i(646190),D=a.i(61263),E=a.i(54301),F=a.i(849793),G=a.i(227565),H=a.i(135464),I=a.i(57265),J=a.i(813682),K=a.i(864020),L=a.i(433217),M=a.i(105528);function N(a){if(0===a)return"0 B";let b=["B","KB","MB","GB","TB"],c=a,d=0;for(;c>=1024&&d<b.length-1;)c/=1024,d++;return`${c.toFixed(1)} ${b[d]}`}function O(a){return 0===a?"0m":a>=1e3?`${(a/1e3).toFixed(2)} cores`:`${a.toFixed(0)}m`}function P(a){return a<70?"success":a<90?"warning":"error"}function Q({deploymentName:a,namespace:g}){let h=(0,M.useModeStore)(a=>a.mode),i=(0,M.useModeStore)(a=>a.selectedNamespace),j=g||i||"default",{data:k,isLoading:l,error:m}=(0,L.useQuery)({queryKey:["pod-metrics",a,j,h],queryFn:async()=>{if("demo"===h){let b=[],c=[];for(let d=0;d<3;d++){let d=`${a}-${Math.random().toString(36).substring(7)}`,e=50+350*Math.random(),f=(100+300*Math.random())*1048576;b.push({podName:d,containerName:a,cpu:`${e.toFixed(0)}m`,memory:`${(f/1024/1024).toFixed(0)}Mi`,cpuValue:e,memoryValue:f}),c.push({podName:d,containerName:a,requests:{cpu:"100m",memory:"128Mi",cpuValue:100,memoryValue:0x8000000},limits:{cpu:"500m",memory:"512Mi",cpuValue:500,memoryValue:0x20000000}})}return{deployment:a,namespace:j,metrics:b,requirements:c,timestamp:new Date().toISOString()}}let b=await fetch(`/api/metrics/pods?deployment=${a}&namespace=${j}&mode=${h}`);if(!b.ok){let a=await b.json();throw Error(a.details||a.error||"Failed to fetch metrics")}return b.json()},enabled:!0,refetchInterval:"demo"===h?5e3:3e4}),n=(0,v.useMemo)(()=>{if(!k)return null;let a=0,b=0,c=0,d=0,e=0,f=0;k.metrics.forEach(b=>{a+=b.cpuValue,d+=b.memoryValue}),k.requirements.forEach(a=>{b+=a.requests.cpuValue,c+=a.limits.cpuValue,e+=a.requests.memoryValue,f+=a.limits.memoryValue});let g=c>0?a/c*100:0,h=f>0?d/f*100:0;return{cpu:{current:a,requested:b,limit:c,usagePercent:g},memory:{current:d,requested:e,limit:f,usagePercent:h},podCount:k.metrics.length}},[k]);return l?(0,b.jsx)(d.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:4},children:(0,b.jsx)(f.default,{})}):m?(0,b.jsxs)(e.default,{severity:"error",children:[(0,b.jsx)(c.default,{variant:"body2",sx:{fontWeight:600,mb:.5},children:"Failed to load metrics"}),(0,b.jsx)(c.default,{variant:"caption",children:m instanceof Error?m.message:"Unknown error"})]}):k&&n?(0,b.jsxs)(d.default,{children:[(0,b.jsxs)(H.default,{container:!0,spacing:3,children:[(0,b.jsx)(H.default,{size:{xs:12,md:6},children:(0,b.jsxs)(I.GlassPanel,{sx:{p:3},children:[(0,b.jsxs)(d.default,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,b.jsxs)(d.default,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,b.jsx)(c.default,{variant:"h6",sx:{fontWeight:600},children:"CPU Usage"}),(0,b.jsx)(J.default,{title:"Percentage of current usage vs. resource limit (Current / Limit × 100%)",arrow:!0,placement:"top",children:(0,b.jsx)(K.default,{fontSize:"small",sx:{color:"text.secondary",cursor:"help"}})})]}),(0,b.jsx)(J.default,{title:`${O(n.cpu.current)} / ${O(n.cpu.limit)}`,arrow:!0,children:(0,b.jsx)(B.StatusBadge,{label:`${n.cpu.usagePercent.toFixed(1)}%`,color:P(n.cpu.usagePercent),size:"small"})})]}),(0,b.jsxs)(d.default,{sx:{mb:3},children:[(0,b.jsxs)(d.default,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,b.jsx)(c.default,{variant:"body2",color:"text.secondary",children:"Current Usage"}),(0,b.jsx)(c.default,{variant:"body2",fontWeight:"medium",children:O(n.cpu.current)})]}),(0,b.jsx)(G.default,{variant:"determinate",value:Math.min(n.cpu.usagePercent,100),color:P(n.cpu.usagePercent),sx:{height:8,borderRadius:1}})]}),(0,b.jsxs)(d.default,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,b.jsxs)(d.default,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,b.jsx)(c.default,{variant:"caption",color:"text.secondary",children:"Requested:"}),(0,b.jsx)(c.default,{variant:"caption",fontWeight:"medium",children:O(n.cpu.requested)})]}),(0,b.jsxs)(d.default,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,b.jsx)(c.default,{variant:"caption",color:"text.secondary",children:"Limit:"}),(0,b.jsx)(c.default,{variant:"caption",fontWeight:"medium",children:O(n.cpu.limit)})]})]})]})}),(0,b.jsx)(H.default,{size:{xs:12,md:6},children:(0,b.jsxs)(I.GlassPanel,{sx:{p:3},children:[(0,b.jsxs)(d.default,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,b.jsxs)(d.default,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,b.jsx)(c.default,{variant:"h6",sx:{fontWeight:600},children:"Memory Usage"}),(0,b.jsx)(J.default,{title:"Percentage of current usage vs. resource limit (Current / Limit × 100%)",arrow:!0,placement:"top",children:(0,b.jsx)(K.default,{fontSize:"small",sx:{color:"text.secondary",cursor:"help"}})})]}),(0,b.jsx)(J.default,{title:`${N(n.memory.current)} / ${N(n.memory.limit)}`,arrow:!0,children:(0,b.jsx)(B.StatusBadge,{label:`${n.memory.usagePercent.toFixed(1)}%`,color:P(n.memory.usagePercent),size:"small"})})]}),(0,b.jsxs)(d.default,{sx:{mb:3},children:[(0,b.jsxs)(d.default,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,b.jsx)(c.default,{variant:"body2",color:"text.secondary",children:"Current Usage"}),(0,b.jsx)(c.default,{variant:"body2",fontWeight:"medium",children:N(n.memory.current)})]}),(0,b.jsx)(G.default,{variant:"determinate",value:Math.min(n.memory.usagePercent,100),color:P(n.memory.usagePercent),sx:{height:8,borderRadius:1}})]}),(0,b.jsxs)(d.default,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,b.jsxs)(d.default,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,b.jsx)(c.default,{variant:"caption",color:"text.secondary",children:"Requested:"}),(0,b.jsx)(c.default,{variant:"caption",fontWeight:"medium",children:N(n.memory.requested)})]}),(0,b.jsxs)(d.default,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,b.jsx)(c.default,{variant:"caption",color:"text.secondary",children:"Limit:"}),(0,b.jsx)(c.default,{variant:"caption",fontWeight:"medium",children:N(n.memory.limit)})]})]})]})})]}),(0,b.jsxs)(d.default,{sx:{mt:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,b.jsxs)(c.default,{variant:"caption",color:"text.secondary",children:["Aggregated from ",n.podCount," pod",1!==n.podCount?"s":""]}),(0,b.jsxs)(c.default,{variant:"caption",color:"text.secondary",children:["Last updated: ",new Date(k.timestamp).toLocaleTimeString()]})]})]}):(0,b.jsx)(e.default,{severity:"warning",children:"No metrics available. Make sure metrics-server is installed in your cluster."})}var R=a.i(563810),S=a.i(848385),T=a.i(468386),U=a.i(943672),V=a.i(176493),W=a.i(631796),X=a.i(177940),Y=a.i(466824),Z=a.i(314449),$=a.i(124089),_=a.i(474288),aa=a.i(784338);function ab({open:a,deploymentName:c,isLoading:d,onConfirm:e,onCancel:f}){return(0,b.jsxs)(S.Dialog,{open:a,onClose:d?void 0:f,maxWidth:"sm",fullWidth:!0,children:[(0,b.jsxs)(T.DialogTitle,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,b.jsx)(aa.default,{color:"warning"}),"Restart Deployment"]}),(0,b.jsxs)(U.DialogContent,{children:[(0,b.jsxs)(V.DialogContentText,{sx:{mb:2},children:["Are you sure you want to restart deployment ",(0,b.jsx)("strong",{children:c}),"?"]}),(0,b.jsxs)(Y.Alert,{severity:"info",sx:{mb:2},children:[(0,b.jsx)(Z.AlertTitle,{children:"What happens during restart"}),(0,b.jsxs)($.Box,{component:"ul",sx:{mt:1,mb:0,pl:2},children:[(0,b.jsx)("li",{children:"All pods will be recreated with a rolling update strategy"}),(0,b.jsx)("li",{children:"New pods will be created before old ones are terminated"}),(0,b.jsx)("li",{children:"Service continuity is maintained (no downtime)"}),(0,b.jsx)("li",{children:"The restart is triggered by updating the pod template annotation"})]})]}),(0,b.jsx)(V.DialogContentText,{variant:"body2",color:"text.secondary",children:"This is a safe operation that maintains service availability through rolling updates."})]}),(0,b.jsxs)(W.DialogActions,{children:[(0,b.jsx)(X.Button,{onClick:f,disabled:d,children:"Cancel"}),(0,b.jsx)(X.Button,{onClick:e,variant:"contained",color:"warning",disabled:d,startIcon:d?(0,b.jsx)(_.CircularProgress,{size:16}):(0,b.jsx)(p.default,{}),children:d?"Restarting...":"Restart Deployment"})]})]})}var ac=a.i(710598),ad=a.i(59168);function ae(){let a=(0,w.useParams)().name,[G,H]=(0,v.useState)(!1),[J,K]=(0,v.useState)(null),[L,M]=(0,v.useState)(!1),[N,O]=(0,v.useState)(!1),[P,S]=(0,v.useState)(!1),[T,U]=(0,v.useState)(!0),{data:V,isLoading:W,error:X,refetch:Y}=(0,x.useDeployment)(a);(0,ad.useAutoRefresh)(Y);let{data:Z,isLoading:$}=(0,x.useDeploymentPods)(a),{data:_}=(0,y.useConfigMaps)(),{data:aa}=(0,z.useSecrets)(),{data:ae}=(0,A.useHPAs)(),af=async()=>{H(!0),K(null),M(!1);try{let b=await fetch(`/api/deployments/${encodeURIComponent(a)}/restart?namespace=${V?.namespace}`,{method:"POST"});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to restart deployment")}M(!0),S(!1),setTimeout(()=>{Y(),M(!1)},2e3)}catch(a){K(a instanceof Error?a.message:"Failed to restart deployment")}finally{H(!1)}},ag=(0,v.useMemo)(()=>{if(!V||!Z)return null;let a=_?.filter(a=>V.configMaps.includes(a.name))||[],b=aa?.filter(a=>V.secrets.includes(a.name))||[];return(0,D.buildDeploymentTopology)(V,Z,a,b,ae||[])},[V,Z,_,aa,ae]);return W?(0,b.jsx)(E.DetailSkeleton,{}):X||!V?(0,b.jsxs)(d.default,{children:[(0,b.jsx)(ac.PageHeader,{title:"Deployment Details",breadcrumbs:[{label:"Deployments",href:"/deployments"},{label:a}]}),(0,b.jsx)(F.ErrorState,{error:X||Error("Deployment not found"),onRetry:()=>Y(),title:"Failed to Load Deployment"})]}):(0,b.jsxs)(d.default,{children:[(0,b.jsx)(ac.PageHeader,{title:(0,b.jsxs)(d.default,{sx:{display:"flex",alignItems:"center",gap:2},children:[V.name,(0,b.jsx)(B.StatusBadge,{status:V.status,size:"medium"})]}),metadata:[`Age: ${V.age}`],breadcrumbs:[{label:"Deployments",href:"/deployments"},{label:V.name}],onRefresh:Y,isRefreshing:W,actions:(0,b.jsxs)(d.default,{sx:{display:"flex",gap:2},children:[(0,b.jsx)(n.GlassButton,{startIcon:(0,b.jsx)(q.default,{}),onClick:()=>O(!0),children:"Edit YAML"}),(0,b.jsx)(n.GlassButton,{startIcon:(0,b.jsx)(p.default,{}),onClick:()=>{S(!0)},disabled:G,sx:{color:a=>a.palette.warning.main,borderColor:a=>a.palette.warning.main},children:"Restart"})]})}),(0,b.jsx)(R.YamlEditorModal,{open:N,onClose:()=>O(!1),resourceName:V.name,namespace:V.namespace,resourceType:"deployment"}),(0,b.jsx)(ab,{open:P,deploymentName:V.name,isLoading:G,onConfirm:af,onCancel:()=>{S(!1)}}),L&&(0,b.jsx)(e.default,{severity:"success",sx:{mb:2},children:"Deployment restart initiated successfully!"}),J&&(0,b.jsx)(e.default,{severity:"error",sx:{mb:2},onClose:()=>K(null),children:J}),(0,b.jsxs)(d.default,{sx:{mb:3},children:[(0,b.jsx)(c.default,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Details"}),(0,b.jsx)(I.GlassPanel,{sx:{p:2},children:(0,b.jsxs)(d.default,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,b.jsxs)(d.default,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,b.jsx)(c.default,{variant:"body2",color:"text.secondary",children:"Strategy:"}),(0,b.jsx)(c.default,{variant:"body2",fontWeight:"medium",children:V.strategy})]}),(0,b.jsxs)(d.default,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,b.jsx)(c.default,{variant:"body2",color:"text.secondary",children:"Desired Replicas:"}),(0,b.jsx)(c.default,{variant:"body2",fontWeight:"medium",children:V.replicas.desired})]}),(0,b.jsxs)(d.default,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,b.jsx)(c.default,{variant:"body2",color:"text.secondary",children:"Ready Replicas:"}),(0,b.jsx)(c.default,{variant:"body2",fontWeight:"medium",children:V.replicas.ready})]}),(0,b.jsxs)(d.default,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,b.jsx)(c.default,{variant:"body2",color:"text.secondary",children:"Available Replicas:"}),(0,b.jsx)(c.default,{variant:"body2",fontWeight:"medium",children:V.replicas.available})]}),(0,b.jsxs)(d.default,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,b.jsx)(c.default,{variant:"body2",color:"text.secondary",children:"Unavailable Replicas:"}),(0,b.jsx)(c.default,{variant:"body2",fontWeight:"medium",children:V.replicas.unavailable})]})]})})]}),(0,b.jsxs)(d.default,{sx:{mb:3},children:[(0,b.jsx)(c.default,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Labels"}),(0,b.jsx)(d.default,{sx:{display:"flex",flexWrap:"wrap",gap:1.5},children:Object.entries(V.labels).map(([a,d])=>(0,b.jsxs)(g.default,{elevation:0,sx:{px:2,py:1,backgroundColor:a=>"dark"===a.palette.mode?"rgba(30, 30, 46, 0.6)":"rgba(255, 255, 255, 0.25)",backdropFilter:"blur(24px) saturate(180%)",WebkitBackdropFilter:"blur(24px) saturate(180%)",border:"1px solid",borderColor:a=>"dark"===a.palette.mode?"rgba(255, 255, 255, 0.12)":"rgba(209, 213, 219, 0.4)",borderRadius:3,display:"flex",alignItems:"center",gap:1},children:[(0,b.jsxs)(c.default,{variant:"caption",color:"text.secondary",fontWeight:600,children:[a,":"]}),(0,b.jsx)(c.default,{variant:"body2",fontWeight:500,children:d})]},a))})]}),(0,b.jsxs)(d.default,{sx:{mb:3},children:[(0,b.jsx)(c.default,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Resources"}),(0,b.jsxs)(d.default,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:[V.configMaps.map(a=>(0,b.jsx)(u.default,{href:`/configmaps/${encodeURIComponent(a)}`,style:{textDecoration:"none"},children:(0,b.jsxs)(g.default,{elevation:0,sx:{p:2.5,minWidth:200,backgroundColor:a=>"dark"===a.palette.mode?"rgba(30, 30, 46, 0.6)":"rgba(255, 255, 255, 0.25)",backdropFilter:"blur(24px) saturate(180%)",WebkitBackdropFilter:"blur(24px) saturate(180%)",border:"1px solid",borderColor:a=>"dark"===a.palette.mode?"rgba(255, 255, 255, 0.12)":"rgba(209, 213, 219, 0.4)",borderRadius:3,transition:"all 0.2s",cursor:"pointer","&:hover":{transform:"translateY(-2px)",borderColor:a=>"dark"===a.palette.mode?"rgba(59, 130, 246, 0.5)":"rgba(59, 130, 246, 0.4)"}},children:[(0,b.jsxs)(d.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[(0,b.jsx)(c.default,{variant:"caption",color:"info.main",fontWeight:600,children:"ConfigMap"}),(0,b.jsx)(r.default,{fontSize:"small",sx:{color:"info.main",opacity:.6}})]}),(0,b.jsx)(c.default,{variant:"body1",fontWeight:500,children:a})]})},a)),V.secrets.map(a=>(0,b.jsx)(u.default,{href:`/secrets/${encodeURIComponent(a)}`,style:{textDecoration:"none"},children:(0,b.jsxs)(g.default,{elevation:0,sx:{p:2.5,minWidth:200,backgroundColor:a=>"dark"===a.palette.mode?"rgba(30, 30, 46, 0.6)":"rgba(255, 255, 255, 0.25)",backdropFilter:"blur(24px) saturate(180%)",WebkitBackdropFilter:"blur(24px) saturate(180%)",border:"1px solid",borderColor:a=>"dark"===a.palette.mode?"rgba(255, 255, 255, 0.12)":"rgba(209, 213, 219, 0.4)",borderRadius:3,transition:"all 0.2s",cursor:"pointer","&:hover":{transform:"translateY(-2px)",borderColor:a=>"dark"===a.palette.mode?"rgba(234, 179, 8, 0.5)":"rgba(234, 179, 8, 0.4)"}},children:[(0,b.jsxs)(d.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[(0,b.jsx)(c.default,{variant:"caption",color:"warning.main",fontWeight:600,children:"Secret"}),(0,b.jsx)(r.default,{fontSize:"small",sx:{color:"warning.main",opacity:.6}})]}),(0,b.jsx)(c.default,{variant:"body1",fontWeight:500,children:a})]})},a))]})]}),(0,b.jsxs)(d.default,{sx:{mb:3},children:[(0,b.jsxs)(d.default,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,b.jsx)(c.default,{variant:"h6",fontWeight:600,children:"Pods"}),Z&&Z.length>3&&(0,b.jsx)(o.default,{size:"small",onClick:()=>U(!T),sx:{color:"text.secondary"},children:T?(0,b.jsx)(t.default,{}):(0,b.jsx)(s.default,{})})]}),(0,b.jsx)(I.GlassPanel,{sx:{p:2},children:$?(0,b.jsx)(d.default,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,b.jsx)(f.default,{})}):Z?.length?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.default,{children:(0,b.jsxs)(h.default,{children:[(0,b.jsx)(l.default,{children:(0,b.jsxs)(m.default,{children:[(0,b.jsx)(j.default,{children:"Name"}),(0,b.jsx)(j.default,{children:"Status"}),(0,b.jsx)(j.default,{children:"Node"}),(0,b.jsx)(j.default,{children:"IP"}),(0,b.jsx)(j.default,{align:"center",children:"Restarts"}),(0,b.jsx)(j.default,{children:"Age"})]})}),(0,b.jsx)(i.default,{children:(T?Z:Z.slice(0,3)).map(a=>(0,b.jsxs)(m.default,{hover:!0,children:[(0,b.jsx)(j.default,{children:(0,b.jsx)(c.default,{variant:"body2",fontWeight:"medium",children:a.name})}),(0,b.jsx)(j.default,{children:(0,b.jsx)(B.StatusBadge,{status:a.status})}),(0,b.jsx)(j.default,{children:(0,b.jsx)(u.default,{href:`/nodes/${encodeURIComponent(a.nodeName)}`,style:{textDecoration:"none"},children:(0,b.jsx)(c.default,{variant:"body2",sx:{color:"primary.main","&:hover":{textDecoration:"underline"},cursor:"pointer"},children:a.nodeName})})}),(0,b.jsx)(j.default,{children:a.ip}),(0,b.jsx)(j.default,{align:"center",children:a.restartCount}),(0,b.jsx)(j.default,{children:a.age})]},a.name))})]})}),!T&&Z.length>3&&(0,b.jsx)(d.default,{sx:{textAlign:"center",mt:1},children:(0,b.jsxs)(c.default,{variant:"caption",color:"text.secondary",children:["Showing 3 of ",Z.length," pods"]})})]}):(0,b.jsx)(d.default,{sx:{p:2},children:(0,b.jsx)(e.default,{severity:"info",children:"No pods found for this deployment"})})})]}),(0,b.jsxs)(d.default,{sx:{mb:3},children:[(0,b.jsx)(c.default,{variant:"h6",sx:{mb:2},children:"Resource Metrics"}),(0,b.jsx)(Q,{deploymentName:a,namespace:V.namespace})]}),ag&&(0,b.jsxs)(d.default,{sx:{mb:3},children:[(0,b.jsx)(c.default,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Topology"}),(0,b.jsx)(C.TopologyGraph,{data:ag,height:500})]})]})}a.s(["default",()=>ae],178907)}];

//# sourceMappingURL=app_app_deployments_%5Bname%5D_page_tsx_61af5ec5._.js.map